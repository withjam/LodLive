"use strict";function lang(e){return $.jStorage.get("language")[$.jStorage.get("selectedLanguage")][e]}function breakLines(e){return e=e.replace(/\//g,'/<span style="font-size:1px"> </span>'),e=e.replace(/&/g,'&<span style="font-size:1px"> </span>'),e=e.replace(/%/g,'%<span style="font-size:1px"> </span>')}!function($){function hashFunc(e){if(!e)return e;for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function LodLiveProfile(){}function LodLive(e){this.profile=e}var jwin=$(window),jbody=$(document.body);$.ajaxSetup({contentType:"application/json",dataType:"jsonp"});var DEFAULT_BOX_TEMPLATE='<div class="boxWrapper defaultBoxTemplate" id="first"><div class="box sprite"></div></div>';LodLive.shortenKey=function(e){e=jQuery.trim(e);var t=e.lastIndexOf("/"),n=e.lastIndexOf("#");return e.substring(t>n?t+1:n+1)},LodLive.prototype.init=function(e,t){var n,o=this;if(console.log("initializing LodLive",e,t),"string"==typeof t?(n=t,t={}):n=t.firstUri,"string"==typeof e&&(e=jQuery(e)),!e.length)throw"LodLive: no context found";this.debugOn=t.debugOn&&window.console,this.context=e,this.imagesMap={},this.mapsMap={},this.infoPanelMap={},this.connection={},this.hashFunc=t.hashFunc||hashFunc,this.innerPageMap={},this.storeIds={},this.boxTemplate=this.profile.boxTemplate||DEFAULT_BOX_TEMPLATE,this.ignoreBnodes=t.ignoreBnodes;var i=$(this.boxTemplate);this.centerBox(i),i.attr("id",this.hashFunc(n)),i.attr("rel",n),i.css("zIndex",1),e.append(i),this.classMap={counter:Math.floor(13*Math.random())+1},this.renewDrag(e.children(".boxWrapper")),this.openDoc(n,i),this.controlPanel("init"),this.msg("","init"),jwin.bind("scroll",function(){o.docInfo(null,"move"),o.controlPanel("move")}),jwin.bind("resize",function(){o.docInfo("","close"),o.controlPanelDiv.remove(),o.controlPanel("init")})},LodLive.prototype.controlPanel=function(e){var t=this,n=t.controlPanelDiv;this.debugOn&&(start=(new Date).getTime()),"init"==e?(n=$('<div class="lodLiveControlPanel"></div>'),t.controlPanelDiv=n,n.css({left:0,top:10,position:"fixed",zIndex:999}),n.append('<div class="lodlive-panel lodlive-panel-options sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-legend sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-help sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-main" ></div>'),n.append('<div class="lodlive-panel2 lodlive-panel-maps sprite" ></div>'),n.append('<div class="lodlive-panel2 lodlive-panel-images sprite" ></div>'),n.children(".lodlive-panel-main,.lodlive-panel-panel2").hover(function(){$(this).setBackgroundPosition({y:-450})},function(){$(this).setBackgroundPosition({y:-400})}),this.context.append(n),n.attr("data-top",n.position().top),n.children(".lodlive-panel").click(function(){var e=$(this);n.children(".lodlive-panel,.lodlive-panel2").hide();var o=$('<div class="lodlive-panel lodlive-panel-close sprite" ></div>');o.click(function(){o.remove(),n.children("#panelContent").remove(),n.removeClass("justX"),n.children(".lodlive-panel,.lodlive-panel2").show(),n.children(".inactive").hide()}),o.hover(function(){$(this).setBackgroundPosition({y:-550})},function(){$(this).setBackgroundPosition({y:-500})}),n.append(o),o.css({position:"absolute",left:241,top:0});var i=$('<div class="lodlive-panel lodlive-panel-content"></div>');if(n.append(i),e.is(".lodlive-panel-options")){var a=$('<ul class="lodlive-panel-options-list"></ul>');i.append("<div></div>"),i.children("div").append("<h2>"+LodLiveUtils.lang("options")+"</h2>").append(a),a.append("<li "+(t.doInverse?'class="checked"':'class="check"')+' data-value="inverse" ><span class="spriteLegenda"></span>'+LodLiveUtils.lang("generateInverse")+"</li>"),a.append("<li "+(t.doAutoExpand?'class="checked"':'class="check"')+' data-value="autoExpand" ><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoExpand")+"</li>"),a.append("<li "+(t.doAutoSameas?'class="checked"':'class="check"')+' data-value="autoSameas"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoSameAs")+"</li>"),a.append("<li "+(t.doCollectImages?'class="checked"':'class="check"')+' data-value="autoCollectImages"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoCollectImages")+"</li>"),a.append("<li "+(t.doDrawMap?'class="checked"':'class="check"')+' data-value="autoDrawMap"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoDrawMap")+"</li>"),a.append("<li>&#160;</li>"),a.append('<li class="reload"><span  class="spriteLegenda"></span>'+LodLiveUtils.lang("restart")+"</li>"),a.children(".reload").click(function(){context.lodlive("close")}),a.children("li[data-value]").click(function(){var e=$(this),o=e.data("value"),a=e.is(".check, :checked");if(e.is(".check")){switch(o){case"inverse":t.doInverse=a;break;case"autoExpand":t.doInverse=a;break;case"autoSameas":t.doAutoSameas=a;break;case"autoCollectImages":t.doCollectImages=a,n.children("div.lodlive-panel-images").toggleClass("inactive");break;case"autoDrawMap":t.doDrawMap=a,n.children("div.lodlive-panel-maps").toggleClass("inactive")}e.toggleClass("checked")}else if(e.is(".help")){var s=n.find(".lodlive-panel-help").children("div").clone();$(".videoHelp",s).fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"iframe",width:853,height:480,speedOut:200,hideOnContentClick:!1,showCloseButton:!0,overlayShow:!1}),i.append(s),s.height()>jwin.height()+10&&n.addClass("justX")}else if(e.is(".legend")){var r=n.find(".legenda").children("div").clone(),l=0;r.find("span.spriteLegenda").each(function(){$(this).css({"background-position":"-1px -"+20*l+"px"}),l++}),i.append(r),r.height()>jwin.height()+10&&n.addClass("justX")}})}t.doCollectImages||n.children("div.lodlive-panel-images").addClass("inactive").hide(),t.doDrawMap||n.children("div.lodlive-panel-maps").addClass("inactive").hide(),n.on("click",".lodlive-panel2",function(){var o=$(this);n.children(".lodlive-panel,.lodlive-panel2").hide();var a=$('<div class="lodlive-panel lodlive-close2 sprite" ></div>');a.click(function(){$(this).remove(),n.find(".lodlive-maps-container, .lodlive-images-container, .inactive").hide(),i.hide(),n.removeClass("justX"),n.children(".lodlive-panel,.lodlive-panel2").show()}),a.hover(function(){$(this).setBackgroundPosition({y:-550})},function(){$(this).setBackgroundPosition({y:-500})}),n.append(a);var s=n.find(".lodlive-panel2-content");if(s.length?s.show():(s=$('<div class="lodlive-panel2-content"></div>'),n.append(s)),o.is(".maps")){var r=s.find(".lodlive-maps-container");r.length?r.show():(r=$('<div class="lodlive-maps-container"></div>'),s.width(800),s.append(r),r.gmap3({action:"init",options:{zoom:2,mapTypeId:google.maps.MapTypeId.HYBRID}})),t.updateMapPanel(n)}else if(e.is(".images")){var l=panel2Contet.find(".lodlive-images-container");l.length?l.show():(l=$('<div class="lodlive-images-container"><span class="lodlive-images-count"></span></div>'),s.append(l)),t.updateImagePanel(n)}})})):"move"===e&&(n.is(".justX")?n.css({position:"absolute",left:jbody.scrollLeft(),top:n.data("top")}):(n.css({left:0,top:10,position:"fixed"}),n.position()&&n.data("top",n.position().top))),t.debugOn&&console.debug((new Date).getTime()-start+"  controlPanel ")},LodLive.prototype.close=function(){document.location=document.location.pathname},LodLive.prototype.composeQuery=function(e,t,n){var o,i,a,s=this,r=s.profile;return s.debugOn&&(start=(new Date).getTime()),jQuery.each(r.connection,function(l,d){for(var c=l.split(","),p=0;p<c.length;p++)if(0===(n?n:e).indexOf(c[p]))return i=LodLiveUtils.getSparqlConf(t,d,r).replace(/\{URI\}/gi,e.replace(/^.*~~/,"")),o=d.proxy?d.proxy+"?endpoint="+d.endpoint+"&"+(d.endpointType?s.profile.endpoints[d.endpointType]:s.profile.endpoints.all)+"&query="+encodeURIComponent(i):d.endpoint+"?"+(d.endpointType?s.profile.endpoints[d.endpointType]:s.profile.endpoints.all)+"&query="+encodeURIComponent(i),a=d.endpoint,!1}),s.debugOn&&console.debug((new Date).getTime()-start+"  composeQuery "),o||(o="http://system/dummy?"+e),a&&s.showInfoConsole&&s.queryConsole("log",{title:a,text:i,id:o,uriId:e}),o},LodLive.prototype.guessingEndpoint=function(e,t,n){var o=e.replace(/(^http:\/\/[^\/]+\/).+/,"$1"),i=this,a=o+"sparql?"+i.profile.endpoints.all+"&query="+encodeURIComponent("select * where {?a ?b ?c} LIMIT 1");$.ajax({url:a,success:function(e){e&&e.results&&e.results.bindings[0]?(i.connections[o]={endpoint:o+"sparql"},t()):n()},error:function(){i.debugOn&&console.log("guessingEndpointError",arguments),n()}})},LodLive.prototype.msg=function(e,t,n,o,i){var a,s=this,r=s.context.find(".lodlive-message-container");switch(e||(e=""),t){case"init":r.length||(r=$('<div class="lodlive-message-container"></div>'),s.context.append(r));break;case"move":r.hide(),r.css({display:"none"});break;case"hide":r.hide()}r.empty(),e=e.replace(/http:\/\/.+~~/g,""),e=e.replace(/nodeID:\/\/.+~~/g,""),e=e.replace(/_:\/\/.+~~/g,""),e=breakLines(e),e=e.replace(/\|/g,"<br />"),a=e.split(" \n "),"fullInfo"===n?(r.append('<div class="corner sprite"></div>'),r.append('<div class="endpoint">'+o+"</div>"),2===a.length?(r.append('<div class="separline sprite"></div>'),r.append('<div class="from upperline">'+(a[0].length>200?a[0].substring(0,200)+"...":a[0])+"</div>"),r.append('<div class="separline sprite"></div>'),r.append('<div class="from upperline">'+a[1]+"</div>")):(r.append('<div class="separline sprite"></div>'),r.append('<div class="from upperline">'+a[0]+"</div>"))):2===a.length?(r.append('<div class="from">'+a[0]+"</div>"),r.append(i?'<div class="separ inverse sprite"></div>':'<div class="separ sprite"></div>'),r.append('<div class="from">'+a[1]+"</div>")):r.append('<div class="from">'+a[0]+"</div>"),r.css({left:0,top:jwin.height()-r.height(),position:"fixed",zIndex:99999999}),r.show()},LodLive.prototype.queryConsole=function(e,t){var n=this,o=n.hashFunc(t.uriId),i=n.hashFunc(t.id),a=n.infoPanelMap,s=a[o];switch(e){case"init":s=n.context.find('<div id="q'+o+'" class="lodlive-query-console"></div>'),a[o]=s,n.infoPanelMap=a;break;case"log":if(s&&t){if(t.resource&&(s.append('<h3 class="sprite"><span>'+t.resource+'</span><a class="sprite">&#160;</a></h3>'),s.on("click","h3 a",function(){n.queryConsole("close",{uriId:t.uriId})}).hover(function(){$(this).setBackgroundPosition({x:-641})},function(){$(this).setBackgroundPosition({x:-611})})),t.title){var r=$('<h4 class="t'+i+' sprite"><span>'+t.title+"</span></h4>");s.append(r),r.hover(function(){r.setBackgroundPosition({y:-700})},function(){r.setBackgroundPosition({y:-650})}),r.click(function(){r.data("show")?(r.data("show",!1),r.setBackgroundPosition({x:-680}),r.removeClass("slideOpen"),r.next("div").slideToggle()):(r.data("show",!0),r.setBackgroundPosition({x:-1290}),s.find(".slideOpen").click(),r.addClass("slideOpen"),r.next("div").slideToggle())})}if(t.text){var l=$('<div><span><span class="contentArea">'+t.text.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span></span></div>"),d=$.trim(s.find("h4.t"+i).clone().find("strong").remove().end().text());if(0===d.indexOf("http:")){var c=$('<span class="linkArea sprite" title="'+LodLiveUtils.lang("executeThisQuery")+'"></span>');c.click(function(){window.open(d+"?query="+encodeURIComponent(t.text))}),c.hover(function(){c.setBackgroundPosition({x:-630})},function(){c.setBackgroundPosition({x:-610})}),l.children("span").prepend(c)}l.css({opacity:.95}),s.append(l)}t.error&&s.find("h4.t"+i+" > span").append('<strong style="float:right">'+LodLiveUtils.lang("enpointNotAvailable")+"</strong>"),"number"==typeof t.founded&&s.find("h4.t"+i+" > span").append(t.founded?'<strong style="float:right">'+t.founded+" "+LodLiveUtils.lang("propsFound")+" </strong>":'<strong style="float:right">'+LodLiveUtils.lang("propsNotFound")+"</strong>"),a[o]=s,globalInfoPanelMap=a}break;case"remove":delete a[o],n.infoPanelMap=a;break;case"show":n.context.append(s);break;case"close":s.detach()}},LodLive.prototype.updateMapPanel=function(e){var t,n=this;if(n.doDrawMap)if(t=n.context.find(".lodlive-maps-container"),t.length&&t.is(":visible")){t.gmap3({action:"clear"});var o=n.context.find(".lodlive-panel2-content");o.width(800);for(var i=e.find(".lodlive-close2"),a=n.mapsMap,s=Object.keys(a),r=s.length,l=r>1?{action:"autofit"}:{};r--;){var d=s[r];$("#mapPanel").gmap3({action:"addMarker",latLng:[a[d].lats,a[d].longs],title:unescape(a[d].title)},l)}i.css({position:"absolute",left:o.width()+1,top:0})}else n.highlight(e.children(".maps"),2,200,"-565px -450px")},LodLive.prototype.updateImagePanel=function(e){var t=this;if(t.doCollectImages){var n=e.find(".lodlive-images-container span:visible");if(n.length){var o=e.find(".lodlive-panel2-content"),i=e.find(".lodlive-close2"),a=t.imagesMap,s=Object.keys(a),r=s.length;if(r>0){n.children(".amsg").remove();for(var l=0;r--;)for(var d=s[r],c=0;c<a[d].length;c++)for(var p in a[d][c]){if(t.noImagesMap[d+l])l--;else if(!n.children(".img-"+d+"-"+l).length){var u=$('<a href="'+unescape(p)+'" class="sprite relatedImage img-'+d+"-"+l+'"><img rel="'+unescape(a[d][c][p])+'" src="'+unescape(p)+'"/></a>"');u.attr("data-prop",d),n.prepend(u),u.fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"image",speedOut:200,hideOnContentClick:!0,showCloseButton:!1,overlayShow:!1}),u.children("img").error(function(){if(u.remove(),l--,3>l)o.width(148);else{var e=(l/3+(l%3>0?1:0)+"").split(".")[0];e>7&&(e=7),o.width(20+128*e)}i.css({position:"absolute",left:o.width()+1,top:0}),t.noImagesMap[d+l]=!0}).load(function(){var n=$(this),a=n.attr("rel"),s=n.width(),r=n.height();r>s?(n.height(113*r/s),n.width(113)):n.css({width:113*s/r,height:113,marginLeft:-((113*s/r-113)/2)});var d=$('<span class="lodlive-image-controls"><span class="imgControlCenter" title="'+LodLiveUtils.lang("showResource")+'"></span><span class="imgControlZoom" title="'+LodLiveUtils.lang("zoomIn")+'"></span><span class="imgTitle">'+a+"</span></span>");if(u.append(d),u.hover(function(){n.hide()},function(){n.show()}),d.children(".imgControlZoom").hover(function(){u.setBackgroundPosition({x:-1955})},function(){u.setBackgroundPosition({x:-1825})}),d.children(".imgControlCenter").hover(function(){u.setBackgroundPosition({x:-2085})},function(){u.setBackgroundPosition({x:-1825})}),d.children(".imgControlCenter").click(function(){return e.find(".lodlive-close2").click(),t.highlight($("#"+u.attr("data-prop")).children(".box"),8,100,"0 0"),!1}),3>l)o.width(148);else{var c=(l/3+(l%3>0?1:0)+"").split(".")[0];c>7&&(c=7),o.width(20+128*c),i.css({position:"absolute",left:o.width()+1,top:0})}})}l++}}else o.width(148),n.children(".amsg").length||n.append('<span class="amsg">'+LodLiveUtils.lang("imagesNotFound")+"</span>");i.css({position:"absolute",left:o.width()+1,top:0})}else t.highlight(e.children(".images"),2,200,"-610px -450px")}},LodLive.prototype.highlight=function(e,t,n,o){var i=this;if(t>0){t--;var a=e.css("background-position");e.doTimeout(n,function(){e.css({"background-position":o}),e.doTimeout(n,function(){e.css({"background-position":a}),i.highlight(e,t,n,o)})})}},LodLive.prototype.renewDrag=function(e){var t,n=this;n.debugOn&&(start=(new Date).getTime()),e.each(function(){var e=$(this),o=e.attr("id");e.is(".ui-draggable")||e.draggable({stack:".boxWrapper",containment:"parent",start:function(){n.context.find(".lodlive-toolbox").remove(),$("#line-"+o).clearCanvas();var e=n.storeIds["rev"+o];if(e)for(var i=0;i<e.length;i++)t=n.storeIds["gen"+e[i]],$("#line-"+e[i]).clearCanvas()},drag:function(){},stop:function(){n.drawAllLines($(this))}})}),n.debugOn&&console.debug((new Date).getTime()-start+"  renewDrag ")},LodLive.prototype.centerBox=function(e){{var t,n=this,o=n.context.height(),i=n.context.width();e.width()||65,e.height()||65}n.debugOn&&(t=(new Date).getTime());var a=(o-65)/2+(n.context.scrollTop()||0),s=(i-65)/2+(n.context.scrollLeft()||0),r={position:"absolute",left:s,top:a};try{e.animate(r,1e3)}catch(l){e.css(r)}n.debugOn&&console.debug((new Date).getTime()-t+"  centerBox ")},LodLive.prototype.autoExpand=function(){var e,t=this;t.debugOn&&(e=(new Date).getTime()),$.each(t.innerPageMap,function(e,n){var o=n.children(".relatedBox:not([class*=exploded])");o.length&&(n.parent().length||t.context.append(n),o.each(function(){box=$(moreInfoOnThis);var e=box.attr("relmd5"),n=t.context.children("#"+e);n.length>0&&box.click()}),t.context.children(".innerPage").detach())}),t.context.find(".relatedBox:not([class*=exploded])").each(function(){var e=$(this),t=e.attr("relmd5"),n=context.children("#"+t);n.length>0&&e.click()}),t.debugOn&&console.debug((new Date).getTime()-e+"  autoExpand ")},LodLive.prototype.addNewDoc=function(e,t,n){var o,i=this;i.debugOn&&(o=(new Date).getTime());var a=t.attr("relmd5"),s=i.context.find("#"+a),r=t.is(".inverse"),l=!0;t=$(t),s.length||(s=$(i.boxTemplate),l=!1);var d=t.data("circleid"),c=$("#"+d);if(i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 01 "),!r){i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 02 ");var p=i.storeIds["gen"+d];if(p){if(-1!=$.inArray(a,p))return;p.push(a)}else p=[a];i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 03 "),i.storeIds["gen"+d]=p,p=i.storeIds["rev"+a],p?-1==$.inArray(d,p)&&p.push(d):p=[d],i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 04 "),i.storeIds["rev"+a]=p}var u=t.data("property"),v=t.attr("rel");s.attr("id",a),s.attr("rel",v);var f=r?'div[data-property="'+u+'"][rel="'+v+'"]':null;if(i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 05 "),t.hide(),l)r?i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 11 "):(i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 10 "),i.renewDrag(i.context.children(".boxWrapper")),i.drawaLine(e,s,u));else{i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 06 ");var h=parseInt(t.attr("data-circlePos"),10),g=parseInt(t.attr("data-circleParts"),10),m=i.circleChords(g>10?h%2>0?3*c.width():2*c.width():5*c.width()/2,g,c.position().left+e.width()/2,c.position().top+c.height()/2,null,h);i.context.append(s),s.css({left:m[0][0]-s.height()/2,top:m[0][1]-s.width()/2,opacity:1,zIndex:99}),i.renewDrag(i.context.children(".boxWrapper")),i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 07 "),r?(debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 09 "),i.openDoc(v,s,f)):(i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 08 "),i.doInverse?i.openDoc(v,s,f):i.openDoc(v,s),i.drawaLine(e,s,u))}return n&&n(),i.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc "),!1},LodLive.prototype.removeDoc=function(e){var t=this;t.debugOn&&(start=(new Date).getTime()),t.context.find(".lodlive-toolbox").remove();var n=e.attr("id");t.queryConsole("remove",{uriId:e.attr("rel")}),t.context.find("#line-"+n).clearCanvas();var o=t.storeIds["rev"+n];if(o)for(var i=0;i<o.length;i++)t.context.find("#line-"+o[i]).clearCanvas();t.docInfo("","close");var a=t.context.find(".lodLiveControlPanel");if(t.doCollectImages){var s=t.imagesMap;s[n]&&(delete s[n],t.updateImagePanel(a),a.find("a[class*=img-"+n+"]").remove())}if(t.doDrawMap){var r=t.mapsMap;r[n]&&(delete r[n],t.updateMapPanel(a))}e.fadeOut("normal",null,function(){e.remove(),$.each(t.innerPageMap,function(e,o){if(o.children("."+n).length){var i=t.context.find("#"+e);i.append(o);var a=i.find(".lastClick").attr("rel");i.children(".innerPage").children("."+a).length||i.children(".innerPage").detach()}}),t.context.find("."+n).each(function(){var e=$(this);e.show(),e.removeClass("exploded")});var o,i,a,s=t.storeIds["gen"+n],r=t.storeIds["rev"+n];if(r)for(o=0;o<r.length;o++)if(a=t.storeIds["gen"+r[o]])for(i=0;i<a.length;i++)a[i]===n&&a.splice(i,1);if(s)for(o=0;o<s.length;o++)if(a=t.storeIds["rev"+s[o]])for(i=0;i<a.length;i++)a[i]==n&&a.splice(i,1);if(r=t.storeIds["rev"+n])for(o=0;o<r.length;o++)if(s=t.storeIds["gen"+r[o]])for(i=0;i<s.length;i++)t.drawaLine(t.context.find("#"+r[o]),t.context.find("#"+s[i]));delete t.storeIds["rev"+n],delete t.storeIds["gen"+n]}),t.debugOn&&console.debug((new Date).getTime()-start+"  removeDoc ")},LodLive.prototype.addClick=function(e,t){var n=this;n.debugOn&&(start=(new Date).getTime()),e.find(".relatedBox").each(function(){var t=$(this);t.attr("relmd5",n.hashFunc(t.attr("rel"))),t.click(function(o){t.addClass("exploded"),n.addNewDoc(e,t),o.stopPropagation()}),t.hover(function(){n.msg(t.data("title"),"show",null,null,t.is(".inverse"))},function(){n.msg(null,"hide")})}),e.find(".groupedRelatedBox").each(function(){var t=$(this);t.click(function(){t.data("show")?(t.data("show",!1),n.docInfo("","close"),t.removeClass("lastClick"),e.find("."+t.attr("rel")).fadeOut("fast"),t.fadeTo("fast",1),e.children(".innerPage").detach()):(t.data("show",!0),e.append(n.innerPageMap[e.attr("id")]),n.docInfo("","close"),e.find(".lastClick").removeClass("lastClick").click(),e.children(".innerPage").length||e.append(n.innerPageMap[e.attr("id")]),t.addClass("lastClick"),e.find("."+t.attr("rel")+":not([class*=exploded])").fadeIn("fast"),t.fadeTo("fast",.3))}),t.hover(function(){n.msg(t.attr("data-title"),"show",null,null,t.is(".inverse"))},function(){n.msg(null,"hide")})}),n.innerPageMap[e.attr("id")]=e.children(".innerPage"),e.children(".innerPage").detach(),e.find(".actionBox[rel=contents]").click(function(){n.docInfo(e,"open")}),e.find(".actionBox[rel=tools]").click(function(){if(n.context.find(".toolBox:visible").length)n.context.find(".toolBox").fadeOut("fast",null,function(){$(".toolBox").remove()});else{var t=e.position(),o=$('<div class="lodlive-toolbox sprite" style="display:none" ><div class="innerActionBox infoQ" rel="infoQ" title="'+LodLiveUtils.lang("moreInfoOnThis")+'" >&#160;</div><div class="innerActionBox center" rel="center" title="'+LodLiveUtils.lang("centerClose")+'" >&#160;</div><div class="innerActionBox newpage" rel="newpage" title="'+LodLiveUtils.lang("openOnline")+'" >&#160;</div><div class="innerActionBox expand" rel="expand" title="'+LodLiveUtils.lang("openRelated")+'" >&#160;</div><div class="innerActionBox remove" rel="remove" title="'+LodLiveUtils.lang("removeResource")+'" >&#160;</div></div>');n.context.append(o),o.css({top:t.top-23,left:t.left+10}),o.fadeIn("fast"),o.find(".innerActionBox[rel=expand]").each(function(){var t=$(this);t.click(function(){function t(){var e=a.eq(i++);e.length&&e.click(),s>i&&window.setTimeout(t,75)}o.remove(),n.docInfo("","close");var i=0,a=e.find(".relatedBox:visible"),s=a.length;window.setTimeout(t,75)}),t.hover(function(){o.setBackgroundPosition({y:-515})},function(){o.setBackgroundPosition({y:-395})})}),o.find(".innerActionBox[rel=infoQ]").each(function(){var t=$(this);t.click(function(){o.remove(),n.queryConsole("show",{uriId:e.attr("rel")})}),t.hover(function(){o.setBackgroundPosition({y:-425})},function(){o.setBackgroundPosition({y:-395})})}),o.find(".innerActionBox[rel=remove]").each(function(){var t=$(this);t.click(function(){n.removeDoc(e),o.remove(),n.docInfo("","close")}),t.hover(function(){o.setBackgroundPosition({y:-545})},function(){o.setBackgroundPosition({y:-395})})}),o.find(".innerActionBox[rel=newpage]").each(function(){var t=$(this);t.click(function(){o.remove(),n.docInfo("","close"),window.open(e.attr("rel"))}),t.hover(function(){t.parent().setBackgroundPosition({y:-485})},function(){t.parent().setBackgroundPosition({y:-395})})}),o.find(".innerActionBox[rel=center]").each(function(){var t=$(this);t.click(function(){var t=$(location).attr("href");-1!=t.indexOf("?http")&&(document.location=t.substring(0,t.indexOf("?"))+"?"+e.attr("rel"))}),t.hover(function(){o.setBackgroundPosition({y:-455})},function(){o.setBackgroundPosition({y:-395})})})}}),t&&t(),n.debugOn&&console.debug((new Date).getTime()-start+"  addClick ")},LodLive.prototype.parseRawResourceDoc=function(destBox,URI){var inst=this;inst.debugOn&&(start=(new Date).getTime());var uris=[],bnodes=[],values=[],def=inst.profile["default"];if(def){var res=LodLiveUtils.getSparqlConf("document",def,inst.profile).replace(/\{URI\}/gi,URI),url=def.endpoint+"?uri="+encodeURIComponent(URI)+"&query="+encodeURIComponent(res);inst.showInfoConsole&&inst.queryConsole("log",{title:LodLiveUtils.lang("endpointNotConfiguredSoInternal"),text:res,uriId:URI}),$.ajax({url:url,beforeSend:function(){inst.context.append(destBox),destBox.html('<img style="margin-left:'+destBox.width()/2+'px;margin-top:147px" src="img/ajax-loader-gray.gif"/>'),destBox.css({position:"fixed",right:20,top:0}),destBox.attr("data-top",destBox.position().top)},success:function(json){json=json.results&&json.results.bindings,$.each(json,function(key,value){eval("uri"===value.object.type?"uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"bnode"==value.object.type?"bnodes.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),destBox.html(""),inst.debugOn&&(console.debug(URI+"   "),console.debug(values)),inst.formatDoc(destBox,values,uris,bnodes,URI)},error:function(){destBox.html(""),values=[{"http://system/msg":"risorsa non trovata: "+destBox.attr("rel")}],inst.formatDoc(destBox,values,uris,bnodes,URI)}})}inst.debugOn&&console.debug((new Date).getTime()-start+"  parseRawResourceDoc ")},LodLive.prototype.docInfo=function(obj,action){var inst=this,docInfo=inst.context.find(".lodlive-docinfo");switch(inst.debugOn&&(start=(new Date).getTime()),action){case"open":var URI=obj.attr("rel");if(docInfo.length&&(docInfo.fadeOut("fast",null,function(){docInfo.remove()}),$('.lodlive-docinfo[rel="info-'+URI+'"]').length>0))return;docInfo=$('<div class="lodlive-docinfo" rel="info-'+URI+'"></div>'),inst.context.append(docInfo);var SPARQLquery=inst.composeQuery(URI,"document"),uris=[],bnodes=[],values=[];0===SPARQLquery.indexOf("http://system/dummy")?inst.parseRawResourceDoc(docInfo,URI):$.ajax({url:SPARQLquery,beforeSend:function(){docInfo.html('<img style="margin-left:'+docInfo.width()/2+'px;margin-top:147px" src="img/ajax-loader-gray.gif"/>'),docInfo.css({position:"fixed",right:15,top:0}),docInfo.attr("data-top",docInfo.position().top)},success:function(json){json=json.results&&json.results.bindings,$.each(json,function(key,value){eval("uri"==value.object.type?"uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"bnode"==value.object.type?"bnodes.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),docInfo.html(""),inst.formatDoc(docInfo,values,uris,bnodes,URI)},error:function(){destBox.html(""),values=[{"http://system/msg":"risorsa non trovata: "+destBox.attr("rel")}],inst.formatDoc(docInfo,values,uris,bnodes,URI)}});break;default:docInfo.fadeOut("fast",null,function(){docInfo.remove()})}inst.debugOn&&console.debug((new Date).getTime()-start+"  docInfo ")},LodLive.prototype.processDraw=function(e,t,n,o,i,a){var s,r=this,l=r.profile;r.debugOn&&(s=(new Date).getTime());var d="",c="standardLine";if(r.context.find("#"+a).length>0){d=i.attr("data-propertyName-"+a);var p=d.split("|");d="\n";for(var u=0;u<p.length;u++){l.arrows[$.trim(p[u])]&&(c=r.profile.arrows[$.trim(p[u])]+"Line");{var v=LodLive.shortenKey(p[u]);v.lastIndexOf("#"),v.lastIndexOf("/")}-1==d.indexOf("\n"+v+"\n")&&(d+=v+"\n")}}"isSameAsLine"!==c?r.standardLine(d,e,t,n,o,i,a):LodLiveUtils.customLines(r.context,c,d,e,t,n,o,i,a),r.debugOn&&console.debug((new Date).getTime()-s+"  processDraw ")},LodLive.prototype.drawAllLines=function(e){var t,n=this,o=e.attr("id"),i=n.storeIds["gen"+o],a=n.storeIds["rev"+o];if(n.context.find("#line-"+o).clearCanvas(),i)for(t=0;t<i.length;t++)n.drawaLine(e,n.context.find("#"+i[t]));if(a)for(t=0;t<a.length;t++)if(i=n.storeIds["gen"+a[t]],$("#line-"+a[t]).clearCanvas(),i)for(var s=0;s<i.length;s++)n.drawaLine(n.context.find("#"+a[t]),n.context.find("#"+i[s]))},LodLive.prototype.drawaLine=function(e,t,n){var o,i=this;i.debugOn&&(o=(new Date).getTime());var a=e.position(),s=t.position(),r=$("#line-"+e.attr("id"));1==r.length?(n&&r.attr("data-propertyName-"+t.attr("id"),n),i.processDraw(a.left+e.width()/2,a.top+e.height()/2,s.left+t.width()/2,s.top+t.height()/2,r,t.attr("id"))):(r=$("<canvas data-propertyName-"+t.attr("id")+'="'+n+'" height="'+i.context.height()+'" width="'+i.context.width()+'" id="line-'+e.attr("id")+'"></canvas>'),i.context.append(r),r.css({position:"absolute",zIndex:"0",top:0,left:0}),i.processDraw(a.left+e.width()/2,a.top+e.height()/2,s.left+t.width()/2,s.top+t.height()/2,r,t.attr("id"))),i.debugOn&&console.debug((new Date).getTime()-o+"  drawaLine ")},LodLive.prototype.formatDoc=function(e,t,n,o,i){var a=this;a.debugOn&&(console.debug("formatDoc 0"),start=(new Date).getTime());var s=a.getJsonValue(n,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","default");e.addClass(a.getProperty("document","className",s));var r=a.getProperty("images","properties",s),l=a.getProperty("weblinks","properties",s),d=a.getProperty("document","propertiesMapper",i.replace(/(http:\/\/[^\/]+\/).+/,"$1"));Array.isArray(r)||(r=[r]),Array.isArray(l)||(l=[l]);var c="<div></div>",p=$(c),u=[];$.each(t,function(e,t){for(var n in t){var o={};o[n]=t[n],u.push(o)}}),a.debugOn&&console.debug("formatDoc 1");var v=[],f=[],h=[];$.each(n,function(e,t){for(var n in t){var o={};o[n]=t[n],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!=n?-1!=$.inArray(n,r)?v.push(o):-1!=$.inArray(n,l)&&f.push(o):h.push(unescape(t[n]))}}),a.debugOn&&console.debug("formatDoc 2");var g=null;v.length>0&&(g=$('<div class="section" style="height:80px"></div>'),$.each(v,function(e,t){for(var n in t)g.append('<a class="relatedImage" href="'+unescape(t[n])+'"><img src="'+unescape(t[n])+'"/></a> ')})),a.debugOn&&console.debug("formatDoc 3");var m=null;f.length>0&&(m='<div class="section"><ul style="padding:0;margin:0;display:block;overflow:hidden;tex-overflow:ellipses">',$.each(f,function(e,t){for(var n in t)m+='<li><a class="relatedLink" target="_blank" data-title="'+n+" \n "+unescape(t[n])+'" href="'+unescape(t[n])+'">'+unescape(t[n])+"</a></li>"}),m+="</ul></div>"),a.debugOn&&console.debug("formatDoc 4");var y=$("<div></div>"),x=$('<div class="topSection sprite"><span>&#160;</span></div>');if(p.append(x),x.find("span").each(function(){var e=$(this);e.click(function(){a.docInfo("","close")}),e.hover(function(){x.setBackgroundPosition({y:-410})},function(){x.setBackgroundPosition({y:-390})})}),a.debugOn&&console.debug("formatDoc 5"),h.length>0){var b=$('<div class="section"><label data-title="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">type</label><div></div></div>');b.find("label").each(function(){var e=$(this);e.hover(function(){a.msg(e.attr("data-title"),"show")},function(){a.msg(null,"hide")})});for(var L=0;L<h.length;L++){var w=LodLive.shortenKey(h[L]);b.children("div").append('<span title="'+h[L]+'">'+w+" </span>")}y.append(b),y.append('<div class="separ sprite"></div>')}if(a.debugOn&&console.debug("formatDoc 6"),g&&(y.append(g),y.append('<div class="separ sprite"></div>')),m){var k=$(m);k.find("a").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),y.append(k),y.append('<div class="separ sprite"></div>')}if(a.debugOn&&console.debug("formatDoc 7"),d?$.each(d,function(e,t){$.each(u,function(n,o){for(var i in o)if(e==i){var s=t;try{var r=$('<div class="section"><label data-title="'+i+'">'+s+"</label><div>"+unescape(o[i])+'</div></div><div class="separ sprite"></div>');r.find("label").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),y.append(r)}catch(l){}return!0}})}):$.each(u,function(e,t){for(var n in t){for(var o=n;o.indexOf("/")>-1;)o=o.substring(o.indexOf("/")+1);for(;o.indexOf("#")>-1;)o=o.substring(o.indexOf("#")+1);try{var i=$('<div class="section"><label data-title="'+n+'">'+o+"</label><div>"+unescape(t[n])+'</div></div><div class="separ sprite"></div>');i.find("label").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),y.append(i)}catch(s){}}}),o.length>0&&$.each(o,function(e,t){for(var n in t){var o=LodLive.shortenKey(n),s=$('<div class="section"><label data-title="'+n+'">'+o+'</label><span class="bnode"></span></div><div class="separ sprite"></div>');
s.find("label").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),a.resolveBnodes(unescape(t[n]),i,s,y)}}),0==u.length&&0==o.length){var b=$('<div class="section"><label data-title="'+LodLiveUtils.lang("resourceMissingDoc")+'"></label><div>'+LodLiveUtils.lang("resourceMissingDoc")+'</div></div><div class="separ sprite"></div>');b.find("label").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),y.append(b)}e.append(p),e.append(y),y.find(".relatedImage").each(function(){$(this).fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"image",speedOut:200,hideOnContentClick:!0,showCloseButton:!1,overlayShow:!1}),$(this).find("img").each(function(){$(this).load(function(){$(this).width()>$(this).height()?($(this).height(80*$(this).height()/$(this).width()),$(this).width(80)):($(this).width(80*$(this).width()/$(this).height()),$(this).height(80))}),$(this).error(function(){$(this).attr("title",LodLiveUtils.lang("noImage")+" \n"+$(this).attr("src")),$(this).attr("src","img/immagine-vuota-"+$.jStorage.get("selectedLanguage")+".png")})})}),y.height()+40>$(window).height()?(e.find("div.separ:last").remove(),e.find("div.separLast").remove(),y.slimScroll({height:$(window).height()-40,color:"#fff"})):e.append('<div class="separLast"></div>'),a.debugOn&&console.debug((new Date).getTime()-start+"  formatDoc ")},LodLive.prototype.resolveBnodes=function(e,t,n,o){var i=this;i.debugOn&&(start=(new Date).getTime());var a=i.composeQuery(e,"bnode",t);return $.ajax({url:a,beforeSend:function(){n.find("span[class=bnode]").html('<img src="img/ajax-loader-black.gif"/>')},success:function(e){n.find("span[class=bnode]").html(""),e=e.results.bindings,$.each(e,function(e,a){var s=LodLive.shortenKey(a.property.value);if("uri"==a.object.type);else if("bnode"==a.object.type){var r=$('<span><label data-title="'+a.property.value+'"> / '+s+'</label><span class="bnode"></span></span>');r.find("label").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),n.find("span[class=bnode]").attr("class","").append(r),i.resolveBnodes(a.object.value,t,n,o)}else n.find("span[class=bnode]").append('<div><em title="'+a.property.value+'">'+s+"</em>: "+a.object.value+"</div>");o.append(n),o.height()+40>$(window).height()?(o.slimScroll({height:$(window).height()-40,color:"#fff"}),o.parent().find("div.separLast").remove()):o.parent().append('<div class="separLast"></div>')})},error:function(){n.find("span").html("")}}),i.debugOn&&console.debug((new Date).getTime()-start+"  resolveBnodes "),e},LodLive.prototype.circleChords=function(e,t,n,o,i,a){var s=this;s.debugOn&&(start=(new Date).getTime());var r=[],l=0;if(a){l=a;var d=2*Math.PI*(l/t);r.push([n+e*Math.cos(d),o+e*Math.sin(d)])}else for(;t>l;l++){var d=2*Math.PI*(l/t);r.push([n+e*Math.cos(d),o+e*Math.sin(d)])}return s.debugOn&&console.debug((new Date).getTime()-start+"  circleChords "),r},LodLive.prototype.getJsonValue=function(e,t,n){var o=this;o.debugOn&&(start=(new Date).getTime());var i=[];return $.each(e,function(e,n){for(var o in n)o==t&&i.push(unescape(n[o]))}),i==[]&&(i=[n]),o.debugOn&&console.debug((new Date).getTime()-start+"  getJsonValue"),i},LodLive.prototype.getProperty=function(e,t,n){var o=this,i=o.profile;if(o.debugOn&&(start=(new Date).getTime()),Array.isArray(n)){for(var a=0;a<n.length;a++)if(i[n[a]]&&i[n[a]][e])return t?i[n[a]][e][t]?i[n[a]][e][t]:i["default"][e][t]:i[n[a]][e]?i[n[a]][e]:i["default"][e]}else if(n+="",i[n]&&i[n][e])return t?i[n][e][t]?i[n][e][t]:i["default"][e][t]:i[n][e]?i[n][e]:i["default"][e];return o.debugOn&&console.debug((new Date).getTime()-start+"  getProperty"),i["default"][e]?t?i["default"][e][t]:i["default"][e]:""},LodLive.prototype.format=function(destBox,values,uris,inverses){var inst=this,classMap=inst.classMap,lodLiveProfile=inst.profile;inst.debugOn&&(start=(new Date).getTime());var containerBox=destBox.parent("div"),thisUri=containerBox.attr("rel")||"",docType=inst.getJsonValue(uris,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","default");-1!=thisUri.indexOf("~~")&&(docType="bnode");var aClass=inst.getProperty("document","className",docType);"bnode"==docType&&(aClass="bnode"),(null==aClass||"standard"==aClass||""==aClass)&&(classMap[docType]?aClass=classMap[docType]:(aClass="box"+classMap.counter,13===classMap.counter?classMap.counter=1:classMap.counter+=1,classMap[docType]=aClass)),containerBox.addClass(aClass);var titles=inst.getProperty("document","titleProperties",docType),images=inst.getProperty("images","properties",docType),weblinks=inst.getProperty("weblinks","properties",docType),lats=inst.getProperty("maps","lats",docType),longs=inst.getProperty("maps","longs",docType),points=inst.getProperty("maps","points",docType);"string"==typeof titles&&(titles=[titles]),"string"==typeof images&&(images=[images]),"string"==typeof weblinks&&(weblinks=[weblinks]),"string"==typeof lats&&(lats=[lats]),"string"==typeof longs&&(longs=[longs]),"string"==typeof points&&(points=[points]),titles.push("http://system/msg");for(var result='<div class="boxTitle"><span class="ellipsis_text">',a=0;a<titles.length;a++){var resultArray=inst.getJsonValue(values,titles[a],0==titles[a].indexOf("http")?"":titles[a]);if(0!=titles[a].indexOf("http"))-1==result.indexOf($.trim(unescape(titles[a]))+" \n")&&(result+=$.trim(unescape(titles[a]))+" \n");else for(var af=0;af<resultArray.length;af++)-1==result.indexOf(unescape(resultArray[af])+" \n")&&(result+=unescape(resultArray[af])+" \n")}var dataEndpoint=containerBox.attr("data-endpoint")||"";(0==values.length&&0==uris.length||0==dataEndpoint.indexOf("http://system/dummy"))&&(-1!=containerBox.attr("data-endpoint").indexOf("http://system/dummy")&&containerBox.attr("data-endpoint",LodLiveUtils.lang("endpointNotConfigured")),0==uris.length&&0==values.length&&(result='<div class="boxTitle" data-tooltip="'+LodLiveUtils.lang("resourceMissing")+'"><a target="_blank" href="'+thisUri+'"><span class="spriteLegenda"></span>'+thisUri+"</a>")),result+="</span></div>";var jResult=$(result);""==jResult.text()&&"bnode"==docType?jResult.text("[blank node]"):""==jResult.text()&&jResult.text(LodLiveUtils.lang("noName")),destBox.append(jResult);var resourceTitle=jResult.text();jResult.data("tooltip",resourceTitle),jResult.css({marginTop:13==jResult.height()?58:26==jResult.height()?51:45,height:jResult.height()+5}),destBox.hover(function(){var e=jResult.text();console.log("destbox hover title",e),inst.msg(e,"show","fullInfo",containerBox.attr("data-endpoint"))},function(){inst.msg(null,"hide")});var connectedDocs=[],invertedDocs=[],propertyGroup={},propertyGroupInverted={},connectedImages=[],connectedLongs=[],connectedLats=[],sameDocControl=[];if($.each(uris,function(key,value){for(var akey in value)if(lodLiveProfile.uriSubstitutor&&$.each(lodLiveProfile.uriSubstitutor,function(e,t){value[akey]=value[akey].replace(t.findStr,t.replaceStr)}),$.inArray(akey,images)>-1)eval("connectedImages.push({'"+value[akey]+"':'"+escape(resourceTitle)+"'})");else if(-1==$.inArray(akey,weblinks))if($.inArray(value[akey],sameDocControl)>-1){var aCounter=0;$.each(connectedDocs,function(key2,value2){for(var akey2 in value2)value2[akey2]==value[akey]&&eval("connectedDocs["+aCounter+"] = {'"+akey2+" | "+akey+"':'"+value[akey]+"'}");aCounter++})}else eval("connectedDocs.push({'"+akey+"':'"+value[akey]+"'})"),sameDocControl.push(value[akey])}),inverses&&(sameDocControl=[],$.each(inverses,function(key,value){for(var akey in value)if("bnode"!=docType||-1==value[akey].indexOf("~~"))if(lodLiveProfile.uriSubstitutor&&$.each(lodLiveProfile.uriSubstitutor,function(e,t){value[akey]=value[akey].replace(escape(t.findStr),escape(t.replaceStr))}),$.inArray(value[akey],sameDocControl)>-1){var aCounter=0;$.each(invertedDocs,function(key2,value2){for(var akey2 in value2)if(value2[akey2]==value[akey]){var theKey=akey2;return akey2!=akey&&(theKey=akey2+" | "+akey),eval("invertedDocs["+aCounter+"] = {'"+theKey+"':'"+value[akey]+"'}"),!1}aCounter++})}else eval("invertedDocs.push({'"+akey+"':'"+value[akey]+"'})"),sameDocControl.push(value[akey])})),inst.doDrawMap){for(var a=0;a<points.length;a++)for(var resultArray=inst.getJsonValue(values,points[a],points[a]),af=0;af<resultArray.length;af++)-1!=resultArray[af].indexOf(" ")?(eval("connectedLongs.push('"+unescape(resultArray[af].split(" ")[1])+"')"),eval("connectedLats.push('"+unescape(resultArray[af].split(" ")[0])+"')")):-1!=resultArray[af].indexOf("-")&&(eval("connectedLongs.push('"+unescape(resultArray[af].split("-")[1])+"')"),eval("connectedLats.push('"+unescape(resultArray[af].split("-")[0])+"')"));for(var a=0;a<longs.length;a++)for(var resultArray=inst.getJsonValue(values,longs[a],longs[a]),af=0;af<resultArray.length;af++)eval("connectedLongs.push('"+unescape(resultArray[af])+"')");for(var a=0;a<lats.length;a++)for(var resultArray=inst.getJsonValue(values,lats[a],lats[a]),af=0;af<resultArray.length;af++)eval("connectedLats.push('"+unescape(resultArray[af])+"')");if(connectedLongs.length>0&&connectedLats.length>0){var mapsMap=inst.mapsMap;mapsMap[containerBox.attr("id")]={longs:connectedLongs[0],lats:connectedLats[0],title:thisUri+"\n"+escape(resourceTitle)},inst.updateMapPanel(inst.context.find(".lodlive-controlPanel"))}}if(inst.doCollectImages&&connectedImages.length>0){var imagesMap=inst.imagesMap;imagesMap[containerBox.attr("id")]=connectedImages,inst.updateImagePanel(inst.context.find(".lodlive-controlPanel"))}var totRelated=connectedDocs.length+invertedDocs.length;if(totRelated>16){$.each(connectedDocs,function(e,t){for(var n in t)if(propertyGroup[n]){var o=propertyGroup[n];o.push(t[n]),propertyGroup[n]=o}else propertyGroup[n]=[t[n]]}),$.each(invertedDocs,function(e,t){for(var n in t)if(propertyGroupInverted[n]){var o=propertyGroupInverted[n];o.push(t[n]),propertyGroupInverted[n]=o}else propertyGroupInverted[n]=[t[n]]}),totRelated=0;for(var prop in propertyGroup)propertyGroup.hasOwnProperty(prop)&&totRelated++;for(var prop in propertyGroupInverted)propertyGroupInverted.hasOwnProperty(prop)&&totRelated++}var chordsList=inst.circleChords(75,24,destBox.position().left+65,destBox.position().top+65),chordsListGrouped=inst.circleChords(95,36,destBox.position().left+65,destBox.position().top+65),a=1,inserted={},counter=0,innerCounter=1,objectList=[],innerObjectList=[];$.each(connectedDocs,function(e,t){16==counter&&(counter=0),1==a||15==a&&(a=1);for(var n in t){var o=null;if(propertyGroup[n]&&propertyGroup[n].length>1){if(!inserted[n]){innerCounter=1,inserted[n]=!0;var i=$('<div class="groupedRelatedBox sprite" rel="'+MD5(n)+'"    data-title="'+n+" \n "+propertyGroup[n].length+" "+LodLiveUtils.lang("connectedResources")+'" ></div>'),s=n.split(" ");if(-1!=unescape(propertyGroup[n][0]).indexOf("~~"))i.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&i.addClass(lodLiveProfile.arrows[s[r]]);i.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),objectList.push(i),a++,counter++}25>innerCounter&&(o=$('<div class="aGrouped relatedBox sprite '+MD5(n)+" "+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"  data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","display:none;position:absolute;top:"+(chordsListGrouped[innerCounter][1]-8)+"px;left:"+(chordsListGrouped[innerCounter][0]-8)+"px"),o.attr("data-circlePos",innerCounter),o.attr("data-circleParts",36),o.attr("data-circleid",containerBox.attr("id"))),innerCounter++}else o=$('<div class="relatedBox sprite '+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"   data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),o.attr("data-circlePos",a),o.attr("data-circleParts",24),a++,counter++;if(o){o.attr("data-circleid",containerBox.attr("id")),o.attr("data-property",n);var s=n.split(" ");if(-1!=o.attr("rel").indexOf("~~"))o.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&o.addClass(lodLiveProfile.arrows[s[r]]);o.hasClass("aGrouped")?innerObjectList.push(o):objectList.push(o)}}}),inserted={},$.each(invertedDocs,function(e,t){16==counter&&(counter=0),1==a||15==a&&(a=1);for(var n in t){var o=null;if(propertyGroupInverted[n]&&propertyGroupInverted[n].length>1){if(!inserted[n]){innerCounter=1,inserted[n]=!0;var i=$('<div class="groupedRelatedBox sprite inverse" rel="'+MD5(n)+'-i"   data-title="'+n+" \n "+propertyGroupInverted[n].length+" "+LodLiveUtils.lang("connectedResources")+'" ></div>'),s=n.split(" ");if(-1!=unescape(propertyGroupInverted[n][0]).indexOf("~~"))i.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&i.addClass(lodLiveProfile.arrows[s[r]]);i.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),objectList.push(i),a++,counter++}if(25>innerCounter){var l=unescape(0==t[n].indexOf("~~")?thisUri+t[n]:t[n]);o=$('<div class="aGrouped relatedBox sprite inverse '+MD5(n)+"-i "+MD5(unescape(t[n]))+' " rel="'+l+'"  data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","display:none;position:absolute;top:"+(chordsListGrouped[innerCounter][1]-8)+"px;left:"+(chordsListGrouped[innerCounter][0]-8)+"px"),o.attr("data-circlePos",innerCounter),o.attr("data-circleParts",36),o.attr("data-circleId",containerBox.attr("id"))}innerCounter++}else o=$('<div class="relatedBox sprite inverse '+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"   data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),o.attr("data-circlePos",a),o.attr("data-circleParts",24),a++,counter++;if(o){o.attr("data-circleId",containerBox.attr("id")),o.attr("data-property",n);var s=n.split(" ");if(-1!=o.attr("rel").indexOf("~~"))o.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&o.addClass(lodLiveProfile.arrows[s[r]]);o.hasClass("aGrouped")?innerObjectList.push(o):objectList.push(o)}}});for(var page=0,totPages=objectList.length>14?objectList.length/14+(objectList.length%14>0?1:0):1,i=0;i<objectList.length;i++){if(i%14==0){page++;var aPage=$('<div class="page page'+page+'" style="display:none"></div>');page>1&&totPages>1&&aPage.append('<div class="pager pagePrev sprite" data-page="page'+(page-1)+'" style="top:'+(chordsList[0][1]-8)+"px;left:"+(chordsList[0][0]-8)+'px"></div>'),totPages>1&&totPages-1>page&&aPage.append('<div class="pager pageNext sprite" data-page="page'+(page+1)+'" style="top:'+(chordsList[15][1]-8)+"px;left:"+(chordsList[15][0]-8)+'px"></div>'),containerBox.append(aPage)}containerBox.children(".page"+page).append(objectList[i])}if(page=0,totPages=innerObjectList.length/24+(innerObjectList.length%24>0?1:0),innerObjectList.length>0){containerBox.append('<div class="innerPage"></div>');for(var i=0;i<innerObjectList.length;i++)containerBox.children(".innerPage").append(innerObjectList[i])}containerBox.children(".page1").fadeIn("fast"),containerBox.children(".page").children(".pager").click(function(){var e=$(this);containerBox.find(".lastClick").removeClass("lastClick").click(),e.parent().fadeOut("fast",null,function(){$(this).parent().children("."+e.attr("data-page")).fadeIn("fast")})});var obj=$('<div class="actionBox contents" rel="contents"  >&#160;</div>');containerBox.append(obj),obj.hover(function(){$(this).parent().children(".box").setBackgroundPosition({y:-260})},function(){$(this).parent().children(".box").setBackgroundPosition({y:0})}),obj=$('<div class="actionBox tools" rel="tools" >&#160;</div>'),containerBox.append(obj),obj.hover(function(){containerBox.children(".box").setBackgroundPosition({y:-130})},function(){containerBox.children(".box").setBackgroundPosition({y:0})}),inst.debugOn&&console.debug((new Date).getTime()-start+"	format ")},LodLive.prototype.openDoc=function(anUri,destBox,fromInverse){var inst=this;anUri||$.error("LodLive: no uri for openDoc"),inst.debugOn&&(start=(new Date).getTime());var uris=[],values=[];inst.showInfoConsole&&(inst.queryConsole("init",{uriId:anUri}),inst.queryConsole("log",{uriId:anUri,resource:anUri})),inst.debugOn&&console.log("composing query with anUri",anUri);var SPARQLquery=inst.composeQuery(anUri,"documentUri");if(inst.doStats&&methods.doStats(anUri),-1!=SPARQLquery.indexOf("endpoint=")){var endpoint=SPARQLquery.substring(SPARQLquery.indexOf("endpoint=")+9);endpoint=endpoint.substring(0,endpoint.indexOf("&")),destBox.attr("data-endpoint",endpoint)}else destBox.attr("data-endpoint",SPARQLquery.substring(0,SPARQLquery.indexOf("?")));0==SPARQLquery.indexOf("http://system/dummy")?inst.guessingEndpoint(anUri,function(){inst.openDoc(anUri,destBox,fromInverse)},function(){inst.parseRawResource(destBox,anUri,fromInverse)}):$.ajax({url:SPARQLquery,beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-8)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results&&json.results.bindings;var conta=0;if($.each(json,function(e,t){var n={},o={};conta++,"uri"===t.object.type||"bnode"===t.object.type?t.object.value==anUri||"bnode"===t.object.type&&inst.ignoreBnodes||(o[t.property.value]=escape("bnode"===t.object.type?anUri+"~~"+t.object.value:t.object.value),uris.push(o)):(n[t.property.value]=escape(t.object.value),values.push(n))}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc eval uris & values"),destBox.children(".box").html(""),inst.doInverse){SPARQLquery=inst.composeQuery(anUri,"inverse");var inverses=[];$.ajax({url:SPARQLquery,beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-5)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,eval("inverses.push({'"+value.property.value+"':'"+("bnode"==value.object.type?anUri+"~~":"")+escape(value.object.value)+"'})")}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc inverse eval uris ");var callback=function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)};if(inst.doAutoSameas){var counter=0,tot=Object.keys(lodLiveProfile).length;inst.findInverseSameAs(anUri,counter,inverses,callback,tot)}else callback()},error:function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris),inst.showInfoConsole&&inst.queryConsole("log",{error:"error",id:SPARQLquery,uriId:anUri}),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}})}else inst.format(destBox.children(".box"),values,uris),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)},error:function(){inst.errorBox(destBox)}}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc")},LodLive.prototype.parseRawResource=function(destBox,resource,fromInverse){var inst=this,values=[],uris=[],lodLiveProfile=inst.profile;if(lodLiveProfile["default"]){var res=LodLiveUtils.getSparqlConf("documentUri",lodLiveProfile["default"],lodLiveProfile).replace(/\{URI\}/gi,resource),url=lodLiveProfile["default"].endpoint+"?uri="+encodeURIComponent(resource)+"&query="+encodeURIComponent(res);inst.showInfoConsole&&inst.queryConsole("log",{title:LodLiveUtils.lang("endpointNotConfiguredSoInternal"),text:res,uriId:resource}),$.ajax({url:url,beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-8)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,"uri"==value.object.type?value.object.value!=resource&&eval("uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})"):eval("values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),inst.debugOn&&console.debug((new Date).getTime()-start+"  openDoc eval uris & values");var inverses=[],callback=function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)};if(inst.doAutoSameas){var counter=0,tot=Object.keys(lodLiveProfile.connection).length;inst.findInverseSameAs(resource,counter,inverses,callback,tot)}else callback()},error:function(e,j,k){destBox.children(".box").html("");var inverses=[];fromInverse&&eval("uris.push({'"+fromInverse.replace(/div\[data-property="([^"]*)"\].*/,"$1")+"':'"+fromInverse.replace(/.*\[rel="([^"]*)"\].*/,"$1")+"'})"),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}})}else{destBox.children(".box").html("");var inverses=[];fromInverse&&eval("uris.push({'"+fromInverse.replace(/div\[data-property="([^"]*)"\].*/,"$1")+"':'"+fromInverse.replace(/.*\[rel="([^"]*)"\].*/,"$1")+"'})"),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}},LodLive.prototype.errorBox=function(e){var t=this;e.children(".box").addClass("errorBox"),e.children(".box").html("");var n=$('<div class="boxTitle"><span>'+LodLiveUtils.lang("enpointNotAvailable")+"</span></div>");e.children(".box").append(n),n.css({marginTop:13==n.height()?58:26==n.height()?51:45});var o=$('<div class="actionBox tools">&#160;</div>');o.click(function(){t.removeDoc(e)}),e.append(o),e.children(".box").hover(function(){t.msg(LodLiveUtils.lang("enpointNotAvailableOrSLow"),"show","fullInfo",e.attr("data-endpoint"))},function(){t.msg(null,"hide")})},LodLive.prototype.allClasses=function(e,t,n,o){var i=this;i.debugOn&&(start=(new Date).getTime()),e=i.composeQuery(e,"allClasses");var a=[];$.ajax({url:e,beforeSend:function(){t.html('<img src="img/ajax-loader.gif"/>')},success:function(e){t.html(LodLiveUtils.lang("choose")),e=e.results&&e.results.bindings,$.each(e,function(t){var n=e[t].object.value;-1==n.indexOf("http://www.openlinksw.com/")&&(n=n.replace(/http:\/\//,""),a.push(n))});for(var i=0;i<a.length;i++)n.append(o.replace(/\{CONTENT\}/g,a[i]))},error:function(){n.append(o.replace(/\{CONTENT\}/g,"si  verificato un errore"))}}),i.debugOn&&console.debug((new Date).getTime()-start+"  allClasses")},LodLive.prototype.findInverseSameAs=function(anUri,counter,inverse,callback,tot){var inst=this,lodLiveProfile=inst.profile;inst.debugOn&&(start=(new Date).getTime());var innerCounter=0;$.each(lodLiveProfile.connection,function(key,value){if(innerCounter===counter){var skip=!1,keySplit=key.split(",");if(value.useForInverseSameAs)for(var a=0;a<keySplit.length;a++)-1!=anUri.indexOf(keySplit[a])&&(skip=!0);else skip=!0;if(skip)return counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback(),!1;var SPARQLquery=value.endpoint+"?"+(value.endpointType?lodLiveProfile.endpoints[value.endpointType]:lodLiveProfile.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri));value.proxy&&(SPARQLquery=value.proxy+"?endpoint="+value.endpoint+"&"+(value.endpointType?lodLiveProfile.endpoints[value.endpointType]:lodLiveProfile.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri))),$.ajax({url:SPARQLquery,timeout:3e3,beforeSend:function(){inst.showInfoConsole&&inst.queryConsole("log",{title:value.endpoint,text:LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri),id:SPARQLquery,uriId:anUri})},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,eval(value.property&&value.property.value?"inverse.splice(1,0,{'"+value.property.value+"':'"+escape(value.object.value)+"'})":"inverse.splice(1,0,{'http://www.w3.org/2002/07/owl#sameAs':'"+escape(value.object.value)+"'})")}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback()},error:function(){inst.showInfoConsole&&inst.queryConsole("log",{error:"error",id:SPARQLquery,uriId:anUri}),counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback()}}),inst.debugOn&&console.debug((new Date).getTime()-start+"  findInverseSameAs "+value.endpoint)}innerCounter++}),inst.debugOn&&console.debug((new Date).getTime()-start+"  findInverseSameAs")},LodLive.prototype.findSubject=function(e,t,n,o,i){var a=this,s=a.profile;a.debugOn&&(start=(new Date).getTime()),$.each(s.connection,function(o,i){for(var a=o.split(","),r=0;r<a.length;r++)-1!=e.indexOf(a[r])&&(e=i.endpoint+"?"+(i.endpointType?s.endpoints[i.endpointType]:s.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("findSubject",i,s).replace(/\{CLASS\}/g,t).replace(/\{VALUE\}/g,n)),i.proxy&&(e=i.proxy+"?endpoint="+i.endpoint+"&"+(i.endpointType?s.endpoints[i.endpointType]:s.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("findSubject",i,s).replace(/\{CLASS\}/g,t).replace(/\{VALUE\}/g,n))))});var r=[];$.ajax({url:e,beforeSend:function(){o.html('<img src="img/ajax-loader.gif"/>')},success:function(e){o.html(""),e=e.results&&e.results.bindings,$.each(e,function(t){r.push(e[t].subject.value)});for(var t=0;t<r.length;t++)i.val(r[t])},error:function(e){o.html("errore: "+e)}}),a.debugOn&&console.debug((new Date).getTime()-start+"  findSubject")},LodLive.prototype.standardLine=function(e,t,n,o,i,a){var s=180*Math.atan2(i-n,o-t)/Math.PI+180,r=t-Math.sqrt((o-t)*(o-t)+(i-n)*(i-n))+60;a.rotateCanvas({rotate:s,x:t,y:n}).drawLine({strokeStyle:"#fff",strokeWidth:1,strokeCap:"bevel",x1:t-60,y1:n,x2:r,y2:n}),s>90&&270>s&&a.rotateCanvas({rotate:180,x:(r+t)/2,y:(n+n)/2}),e=$.trim(e).replace(/\n/g,", "),a.drawText({fillStyle:"#606060",strokeStyle:"#606060",x:(r+t+(t+60>o?-60:60))/2,y:(n+n-(t+60>o?18:-18))/2,text:e,align:"center",strokeWidth:.01,fontSize:11,fontFamily:"'Open Sans',Verdana"}).restoreCanvas().restoreCanvas(),s=Math.atan2(i-n,o-t);var l=.79,d=Math.abs(8/Math.cos(l)),c=o-60*Math.cos(s),p=i-60*Math.sin(s),u=s+Math.PI+l,v=o+Math.cos(u)*d-60*Math.cos(s),f=i+Math.sin(u)*d-60*Math.sin(s),h=s+Math.PI-l,g=o+Math.cos(h)*d-60*Math.cos(s),m=i+Math.sin(h)*d-60*Math.sin(s);a.drawLine({strokeStyle:"#fff",strokeWidth:1,x1:c,y1:p,x2:g,y2:m}),a.drawLine({strokeStyle:"#fff",strokeWidth:1,x1:c,y1:p,x2:v,y2:f})},window.LodLive||(window.LodLive=LodLive),jQuery.fn.lodlive=function(e){return arguments.length?("string"==typeof e&&(e={method:e}),this.each(function(){var t=$(this),n=t.data("lodlive-instance");e.method&&"init"!==e.method.toLowerCase()?LodLive.prototype.hasOwnProperty(method)&&t.data("lodlive-instance")?n[method].apply(n,method.args||[]):jQuery.error("Method "+method+" does not exist on jQuery.lodlive"):(n=new LodLive(e.profile),t.data("lodlive-instance",n),n.init(t,e))})):this.data("lodlive-instance")}}(jQuery),function(){var e={},t={};e.getSparqlConf=function(e,t,n){return t.sparql&&t.sparql[e]?t.sparql[e]:n["default"].sparql[e]},e.registerTranslation=function(e,n){t[e]=n},e.setDefaultTranslation=function(e){t["default"]=t[e]||t["default"]},e.lang=function(e,n){var o=n?t[n]||t["default"]:t["default"];return o&&o[e]||e},e.isSameAsLine=function(e,t,n,o,i,a){var s=180*Math.atan2(i-n,o-t)/Math.PI+180,r=t-Math.sqrt((o-t)*(o-t)+(i-n)*(i-n))+60;a.rotateCanvas({rotate:s,x:t,y:n}).drawLine({strokeStyle:"#000",strokeWidth:1,strokeCap:"bevel",x1:t-60,y1:n,x2:r,y2:n}),s>90&&270>s&&a.rotateCanvas({rotate:180,x:(r+t)/2,y:(n+n)/2}),e=$.trim(e).replace(/\n/g,", "),a.drawText({fillStyle:"#000",strokeStyle:"#000",x:(r+t+(t+60>o?-60:60))/2,y:(n+n-(t+60>o?18:-18))/2,text:(t+60>o?"  ":"")+e+(t+60>o?"":"  "),align:"center",strokeWidth:.01,fontSize:11,fontFamily:"'Open Sans',Verdana"}).restoreCanvas().restoreCanvas(),s=Math.atan2(i-n,o-t);var l=.79,d=Math.abs(8/Math.cos(l)),c=o-60*Math.cos(s),p=i-60*Math.sin(s),u=s+Math.PI+l,v=o+Math.cos(u)*d-60*Math.cos(s),f=i+Math.sin(u)*d-60*Math.sin(s),h=s+Math.PI-l,g=o+Math.cos(h)*d-60*Math.cos(s),m=i+Math.sin(h)*d-60*Math.sin(s);a.drawLine({strokeStyle:"#000",strokeWidth:1,x1:c,y1:p,x2:g,y2:m}),a.drawLine({strokeStyle:"#000",strokeWidth:1,x1:c,y1:p,x2:v,y2:f})},e.customLines=function(t,n){return console.log("customLines",n),e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,2)):void 0},window.LodLiveUtils||(window.LodLiveUtils=e)}(),$.fn.setBackgroundPosition=function(e){var t=$.trim(this.css("background-position")),n=-1==t.indexOf("left")?!1:!0;t=t.replace(/top/gi,"").replace(/left/gi,""),t=$.trim(t.replace(/  /g," "));try{var o=t.split(" ");(e.x||0==e.x)&&(o[0]=e.x+"px"),(e.y||0==e.y)&&(o[1]=e.y+"px"),t=n?"left "+o[0]+" top "+o[1]:o[0]+" "+o[1]}catch(i){alert(i)}return this.css({"background-position":t}),this};var MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,o,i,a,s;return i=2147483648&e,a=2147483648&t,n=1073741824&e,o=1073741824&t,s=(1073741823&e)+(1073741823&t),n&o?2147483648^s^i^a:n|o?1073741824&s?3221225472^s^i^a:1073741824^s^i^a:s^i^a}function o(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function r(e,i,a,s,r,l,d){return e=n(e,n(n(o(i,a,s),r),d)),n(t(e,l),i)}function l(e,o,a,s,r,l,d){return e=n(e,n(n(i(o,a,s),r),d)),n(t(e,l),o)}function d(e,o,i,s,r,l,d){return e=n(e,n(n(a(o,i,s),r),d)),n(t(e,l),o)}function c(e,o,i,a,r,l,d){return e=n(e,n(n(s(o,i,a),r),d)),n(t(e,l),o)}function p(e){for(var t,n=e.length,o=n+8,i=(o-o%64)/64,a=16*(i+1),s=Array(a-1),r=0,l=0;n>l;)t=(l-l%4)/4,r=l%4*8,s[t]=s[t]|e.charCodeAt(l)<<r,l++;return t=(l-l%4)/4,r=l%4*8,s[t]=s[t]|128<<r,s[a-2]=n<<3,s[a-1]=n>>>29,s}function u(e){var t,n,o="",i="";for(n=0;3>=n;n++)t=e>>>8*n&255,i="0"+t.toString(16),o+=i.substr(i.length-2,2);return o}function v(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);128>o?t+=String.fromCharCode(o):o>127&&2048>o?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}if(!e)return"";e=e.replace(/http:\/\/.+~~/g,""),e=e.replace(/nodeID:\/\/.+~~/g,""),e=e.replace(/_:\/\/.+~~/g,"");var f,h,g,m,y,x,b,L,w,k=Array(),I=7,C=12,$=17,P=22,B=5,D=9,O=14,j=20,T=4,S=11,U=16,A=23,M=6,R=10,q=15,Q=21;for(e=v(e),k=p(e),x=1732584193,b=4023233417,L=2562383102,w=271733878,f=0;f<k.length;f+=16)h=x,g=b,m=L,y=w,x=r(x,b,L,w,k[f+0],I,3614090360),w=r(w,x,b,L,k[f+1],C,3905402710),L=r(L,w,x,b,k[f+2],$,606105819),b=r(b,L,w,x,k[f+3],P,3250441966),x=r(x,b,L,w,k[f+4],I,4118548399),w=r(w,x,b,L,k[f+5],C,1200080426),L=r(L,w,x,b,k[f+6],$,2821735955),b=r(b,L,w,x,k[f+7],P,4249261313),x=r(x,b,L,w,k[f+8],I,1770035416),w=r(w,x,b,L,k[f+9],C,2336552879),L=r(L,w,x,b,k[f+10],$,4294925233),b=r(b,L,w,x,k[f+11],P,2304563134),x=r(x,b,L,w,k[f+12],I,1804603682),w=r(w,x,b,L,k[f+13],C,4254626195),L=r(L,w,x,b,k[f+14],$,2792965006),b=r(b,L,w,x,k[f+15],P,1236535329),x=l(x,b,L,w,k[f+1],B,4129170786),w=l(w,x,b,L,k[f+6],D,3225465664),L=l(L,w,x,b,k[f+11],O,643717713),b=l(b,L,w,x,k[f+0],j,3921069994),x=l(x,b,L,w,k[f+5],B,3593408605),w=l(w,x,b,L,k[f+10],D,38016083),L=l(L,w,x,b,k[f+15],O,3634488961),b=l(b,L,w,x,k[f+4],j,3889429448),x=l(x,b,L,w,k[f+9],B,568446438),w=l(w,x,b,L,k[f+14],D,3275163606),L=l(L,w,x,b,k[f+3],O,4107603335),b=l(b,L,w,x,k[f+8],j,1163531501),x=l(x,b,L,w,k[f+13],B,2850285829),w=l(w,x,b,L,k[f+2],D,4243563512),L=l(L,w,x,b,k[f+7],O,1735328473),b=l(b,L,w,x,k[f+12],j,2368359562),x=d(x,b,L,w,k[f+5],T,4294588738),w=d(w,x,b,L,k[f+8],S,2272392833),L=d(L,w,x,b,k[f+11],U,1839030562),b=d(b,L,w,x,k[f+14],A,4259657740),x=d(x,b,L,w,k[f+1],T,2763975236),w=d(w,x,b,L,k[f+4],S,1272893353),L=d(L,w,x,b,k[f+7],U,4139469664),b=d(b,L,w,x,k[f+10],A,3200236656),x=d(x,b,L,w,k[f+13],T,681279174),w=d(w,x,b,L,k[f+0],S,3936430074),L=d(L,w,x,b,k[f+3],U,3572445317),b=d(b,L,w,x,k[f+6],A,76029189),x=d(x,b,L,w,k[f+9],T,3654602809),w=d(w,x,b,L,k[f+12],S,3873151461),L=d(L,w,x,b,k[f+15],U,530742520),b=d(b,L,w,x,k[f+2],A,3299628645),x=c(x,b,L,w,k[f+0],M,4096336452),w=c(w,x,b,L,k[f+7],R,1126891415),L=c(L,w,x,b,k[f+14],q,2878612391),b=c(b,L,w,x,k[f+5],Q,4237533241),x=c(x,b,L,w,k[f+12],M,1700485571),w=c(w,x,b,L,k[f+3],R,2399980690),L=c(L,w,x,b,k[f+10],q,4293915773),b=c(b,L,w,x,k[f+1],Q,2240044497),x=c(x,b,L,w,k[f+8],M,1873313359),w=c(w,x,b,L,k[f+15],R,4264355552),L=c(L,w,x,b,k[f+6],q,2734768916),b=c(b,L,w,x,k[f+13],Q,1309151649),x=c(x,b,L,w,k[f+4],M,4149444226),w=c(w,x,b,L,k[f+11],R,3174756917),L=c(L,w,x,b,k[f+2],q,718787259),b=c(b,L,w,x,k[f+9],Q,3951481745),x=n(x,h),b=n(b,g),L=n(L,m),w=n(w,y);
var E=u(x)+u(b)+u(L)+u(w);return E.toLowerCase()};