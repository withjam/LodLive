"use strict";function lang(e){return $.jStorage.get("language")[$.jStorage.get("selectedLanguage")][e]}function breakLines(e){return e=e.replace(/\//g,'/<span style="font-size:1px"> </span>'),e=e.replace(/&/g,'&<span style="font-size:1px"> </span>'),e=e.replace(/%/g,'%<span style="font-size:1px"> </span>')}!function($){function hashFunc(e){if(!e)return e;for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function LodLiveProfile(){}function LodLive(e,t){if(this.container=e,this.options=t,this.UI=t.UI||{},this.debugOn=t.debugOn&&window.console,this.container=e.css("position","relative"),this.context=jQuery('<div class="lodlive-graph-context"></div>').appendTo(e).wrap('<div class="lodlive-graph-container"></div>'),"string"==typeof e&&(e=jQuery(e)),!e.length)throw"LodLive: no container found"}var jwin=$(window),jbody=$(document.body),DEFAULT_BOX_TEMPLATE='<div class="boxWrapper lodlive-node defaultBoxTemplate" id="first"><div class="lodlive-node-label box sprite"></div></div>';LodLive.shortenKey=function(e){e=jQuery.trim(e);var t=e.lastIndexOf("/"),n=e.lastIndexOf("#");return e.substring(t>n?t+1:n+1)},LodLive.prototype.init=function(e){this.imagesMap={},this.mapsMap={},this.infoPanelMap={},this.connection={},this.hashFunc=this.options.hashFunc||hashFunc,this.innerPageMap={},this.storeIds={},this.boxTemplate=this.options.boxTemplate||DEFAULT_BOX_TEMPLATE,this.ignoreBnodes=this.UI.ignoreBnodes;var t=$(this.boxTemplate);this.centerBox(t),t.attr("id",this.hashFunc(e)),t.attr("rel",e),t.css("zIndex",1),this.context.append(t),this.classMap={counter:Math.floor(13*Math.random())+1},this.renewDrag(this.context.children(".boxWrapper")),this.openDoc(e,t),this.controlPanel("init"),this.msg("","init")},LodLive.prototype.controlPanel=function(e){var t=this,n=t.controlPanelDiv;this.debugOn&&(start=(new Date).getTime()),"init"==e?(n=$('<div class="lodLiveControlPanel"></div>'),t.controlPanelDiv=n,n.css({left:0,top:10,position:"fixed",zIndex:999}),n.append('<div class="lodlive-panel lodlive-panel-options sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-legend sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-help sprite" ></div>'),n.append('<div class="lodlive-panel lodlive-panel-main" ></div>'),n.append('<div class="lodlive-panel2 lodlive-panel-maps sprite" ></div>'),n.append('<div class="lodlive-panel2 lodlive-panel-images sprite" ></div>'),n.children(".lodlive-panel-main,.lodlive-panel-panel2").hover(function(){$(this).setBackgroundPosition({y:-450})},function(){$(this).setBackgroundPosition({y:-400})}),this.context.append(n),n.attr("data-top",n.position().top),n.children(".lodlive-panel").click(function(){var e=$(this);n.children(".lodlive-panel,.lodlive-panel2").hide();var o=$('<div class="lodlive-panel lodlive-panel-close sprite" ></div>');o.click(function(){o.remove(),n.children("#panelContent").remove(),n.removeClass("justX"),n.children(".lodlive-panel,.lodlive-panel2").show(),n.children(".inactive").hide()}),o.hover(function(){$(this).setBackgroundPosition({y:-550})},function(){$(this).setBackgroundPosition({y:-500})}),n.append(o),o.css({position:"absolute",left:241,top:0});var a=$('<div class="lodlive-panel lodlive-panel-content"></div>');if(n.append(a),e.is(".lodlive-panel-options")){var i=$('<ul class="lodlive-panel-options-list"></ul>');a.append("<div></div>"),a.children("div").append("<h2>"+LodLiveUtils.lang("options")+"</h2>").append(i),i.append("<li "+(t.doInverse?'class="checked"':'class="check"')+' data-value="inverse" ><span class="spriteLegenda"></span>'+LodLiveUtils.lang("generateInverse")+"</li>"),i.append("<li "+(t.doAutoExpand?'class="checked"':'class="check"')+' data-value="autoExpand" ><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoExpand")+"</li>"),i.append("<li "+(t.doAutoSameas?'class="checked"':'class="check"')+' data-value="autoSameas"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoSameAs")+"</li>"),i.append("<li "+(t.doCollectImages?'class="checked"':'class="check"')+' data-value="autoCollectImages"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoCollectImages")+"</li>"),i.append("<li "+(t.doDrawMap?'class="checked"':'class="check"')+' data-value="autoDrawMap"><span class="spriteLegenda"></span>'+LodLiveUtils.lang("autoDrawMap")+"</li>"),i.append("<li>&#160;</li>"),i.append('<li class="reload"><span  class="spriteLegenda"></span>'+LodLiveUtils.lang("restart")+"</li>"),i.children(".reload").click(function(){context.lodlive("close")}),i.children("li[data-value]").click(function(){var e=$(this),o=e.data("value"),i=e.is(".check, :checked");if(e.is(".check")){switch(o){case"inverse":t.doInverse=i;break;case"autoExpand":t.doInverse=i;break;case"autoSameas":t.doAutoSameas=i;break;case"autoCollectImages":t.doCollectImages=i,n.children("div.lodlive-panel-images").toggleClass("inactive");break;case"autoDrawMap":t.doDrawMap=i,n.children("div.lodlive-panel-maps").toggleClass("inactive")}e.toggleClass("checked")}else if(e.is(".help")){var s=n.find(".lodlive-panel-help").children("div").clone();$(".videoHelp",s).fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"iframe",width:853,height:480,speedOut:200,hideOnContentClick:!1,showCloseButton:!0,overlayShow:!1}),a.append(s),s.height()>jwin.height()+10&&n.addClass("justX")}else if(e.is(".legend")){var r=n.find(".legenda").children("div").clone(),l=0;r.find("span.spriteLegenda").each(function(){$(this).css({"background-position":"-1px -"+20*l+"px"}),l++}),a.append(r),r.height()>jwin.height()+10&&n.addClass("justX")}})}t.doCollectImages||n.children("div.lodlive-panel-images").addClass("inactive").hide(),t.doDrawMap||n.children("div.lodlive-panel-maps").addClass("inactive").hide(),n.on("click",".lodlive-panel2",function(){var o=$(this);n.children(".lodlive-panel,.lodlive-panel2").hide();var i=$('<div class="lodlive-panel lodlive-close2 sprite" ></div>');i.click(function(){$(this).remove(),n.find(".lodlive-maps-container, .lodlive-images-container, .inactive").hide(),a.hide(),n.removeClass("justX"),n.children(".lodlive-panel,.lodlive-panel2").show()}),i.hover(function(){$(this).setBackgroundPosition({y:-550})},function(){$(this).setBackgroundPosition({y:-500})}),n.append(i);var s=n.find(".lodlive-panel2-content");if(s.length?s.show():(s=$('<div class="lodlive-panel2-content"></div>'),n.append(s)),o.is(".maps")){var r=s.find(".lodlive-maps-container");r.length?r.show():(r=$('<div class="lodlive-maps-container"></div>'),s.width(800),s.append(r),r.gmap3({action:"init",options:{zoom:2,mapTypeId:google.maps.MapTypeId.HYBRID}})),t.updateMapPanel(n)}else if(e.is(".images")){var l=panel2Contet.find(".lodlive-images-container");l.length?l.show():(l=$('<div class="lodlive-images-container"><span class="lodlive-images-count"></span></div>'),s.append(l)),t.updateImagePanel(n)}})})):"move"===e&&(n.is(".justX")?n.css({position:"absolute",left:jbody.scrollLeft(),top:n.data("top")}):(n.css({left:0,top:10,position:"fixed"}),n.position()&&n.data("top",n.position().top))),t.debugOn&&console.debug((new Date).getTime()-start+"  controlPanel ")},LodLive.prototype.close=function(){document.location=document.location.pathname},LodLive.prototype.composeQuery=function(e,t,n){var o,a,i,s=this,r=s.options;return s.debugOn&&(start=(new Date).getTime()),jQuery.each(r.connection,function(l,d){for(var c=l.split(","),p=0;p<c.length;p++)if(0===(n?n:e).indexOf(c[p]))return a=LodLiveUtils.getSparqlConf(t,d,r).replace(/\{URI\}/gi,e.replace(/^.*~~/,"")),o=d.proxy?d.proxy+"?endpoint="+d.endpoint+"&"+(d.endpointType?s.options.endpoints[d.endpointType]:s.options.endpoints.all)+"&query="+encodeURIComponent(a):d.endpoint+"?"+(d.endpointType?s.options.endpoints[d.endpointType]:s.options.endpoints.all)+"&query="+encodeURIComponent(a),i=d.endpoint,!1}),s.debugOn&&console.debug((new Date).getTime()-start+"  composeQuery "),o||(o="http://system/dummy?"+e),i&&s.showInfoConsole&&s.queryConsole("log",{title:i,text:a,id:o,uriId:e}),o},LodLive.prototype.guessingEndpoint=function(e,t,n){var o=e.replace(/(^http:\/\/[^\/]+\/).+/,"$1"),a=this,i=o+"sparql?"+a.options.endpoints.all+"&query="+encodeURIComponent("select * where {?a ?b ?c} LIMIT 1");$.ajax({url:i,contentType:"application/json",dataType:"jsonp",success:function(e){e&&e.results&&e.results.bindings[0]?(a.connections[o]={endpoint:o+"sparql"},t()):n()},error:function(){a.debugOn&&console.log("guessingEndpointError",arguments),n()}})},LodLive.prototype.msg=function(e,t,n,o,a){var i,s=this,r=s.container.find(".lodlive-message-container");switch(e||(e=""),t){case"init":r.length||(r=$('<div class="lodlive-message-container"></div>'),s.container.append(r));break;default:r.hide()}r.empty(),e=e.replace(/http:\/\/.+~~/g,""),e=e.replace(/nodeID:\/\/.+~~/g,""),e=e.replace(/_:\/\/.+~~/g,""),e=breakLines(e),e=e.replace(/\|/g,"<br />"),i=e.split(" \n "),"fullInfo"===n?(r.append('<div class="endpoint">'+o+"</div>"),2===i.length?(r.append('<div class="from upperline">'+(i[0].length>200?i[0].substring(0,200)+"...":i[0])+"</div>"),r.append('<div class="from upperline">'+i[1]+"</div>")):r.append('<div class="from upperline">'+i[0]+"</div>")):2===i.length?(r.append('<div class="from">'+i[0]+"</div>"),r.append(a?'<div class="separ inverse sprite"></div>':'<div class="separ sprite"></div>'),r.append('<div class="from">'+i[1]+"</div>")):r.append('<div class="from">'+i[0]+"</div>"),r.show()},LodLive.prototype.queryConsole=function(e,t){var n=this,o=n.hashFunc(t.uriId),a=n.hashFunc(t.id),i=n.infoPanelMap,s=i[o];switch(e){case"init":s=n.context.find('<div id="q'+o+'" class="lodlive-query-console"></div>'),i[o]=s,n.infoPanelMap=i;break;case"log":if(s&&t){if(t.resource&&(s.append('<h3 class="sprite"><span>'+t.resource+'</span><a class="sprite">&#160;</a></h3>'),s.on("click","h3 a",function(){n.queryConsole("close",{uriId:t.uriId})}).hover(function(){$(this).setBackgroundPosition({x:-641})},function(){$(this).setBackgroundPosition({x:-611})})),t.title){var r=$('<h4 class="t'+a+' sprite"><span>'+t.title+"</span></h4>");s.append(r),r.hover(function(){r.setBackgroundPosition({y:-700})},function(){r.setBackgroundPosition({y:-650})}),r.click(function(){r.data("show")?(r.data("show",!1),r.setBackgroundPosition({x:-680}),r.removeClass("slideOpen"),r.next("div").slideToggle()):(r.data("show",!0),r.setBackgroundPosition({x:-1290}),s.find(".slideOpen").click(),r.addClass("slideOpen"),r.next("div").slideToggle())})}if(t.text){var l=$('<div><span><span class="contentArea">'+t.text.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span></span></div>"),d=$.trim(s.find("h4.t"+a).clone().find("strong").remove().end().text());if(0===d.indexOf("http:")){var c=$('<span class="linkArea sprite" title="'+LodLiveUtils.lang("executeThisQuery")+'"></span>');c.click(function(){window.open(d+"?query="+encodeURIComponent(t.text))}),c.hover(function(){c.setBackgroundPosition({x:-630})},function(){c.setBackgroundPosition({x:-610})}),l.children("span").prepend(c)}l.css({opacity:.95}),s.append(l)}t.error&&s.find("h4.t"+a+" > span").append('<strong style="float:right">'+LodLiveUtils.lang("enpointNotAvailable")+"</strong>"),"number"==typeof t.founded&&s.find("h4.t"+a+" > span").append(t.founded?'<strong style="float:right">'+t.founded+" "+LodLiveUtils.lang("propsFound")+" </strong>":'<strong style="float:right">'+LodLiveUtils.lang("propsNotFound")+"</strong>"),i[o]=s,globalInfoPanelMap=i}break;case"remove":delete i[o],n.infoPanelMap=i;break;case"show":n.context.append(s);break;case"close":s.detach()}},LodLive.prototype.updateMapPanel=function(e){var t,n=this;if(n.doDrawMap)if(t=n.context.find(".lodlive-maps-container"),t.length&&t.is(":visible")){t.gmap3({action:"clear"});var o=n.context.find(".lodlive-panel2-content");o.width(800);for(var a=e.find(".lodlive-close2"),i=n.mapsMap,s=Object.keys(i),r=s.length,l=r>1?{action:"autofit"}:{};r--;){var d=s[r];$("#mapPanel").gmap3({action:"addMarker",latLng:[i[d].lats,i[d].longs],title:unescape(i[d].title)},l)}a.css({position:"absolute",left:o.width()+1,top:0})}else n.highlight(e.children(".maps"),2,200,"-565px -450px")},LodLive.prototype.updateImagePanel=function(e){var t=this;if(t.doCollectImages){var n=e.find(".lodlive-images-container span:visible");if(n.length){var o=e.find(".lodlive-panel2-content"),a=e.find(".lodlive-close2"),i=t.imagesMap,s=Object.keys(i),r=s.length;if(r>0){n.children(".amsg").remove();for(var l=0;r--;)for(var d=s[r],c=0;c<i[d].length;c++)for(var p in i[d][c]){if(t.noImagesMap[d+l])l--;else if(!n.children(".img-"+d+"-"+l).length){var u=$('<a href="'+unescape(p)+'" class="sprite relatedImage img-'+d+"-"+l+'"><img rel="'+unescape(i[d][c][p])+'" src="'+unescape(p)+'"/></a>"');u.attr("data-prop",d),n.prepend(u),u.fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"image",speedOut:200,hideOnContentClick:!0,showCloseButton:!1,overlayShow:!1}),u.children("img").error(function(){if(u.remove(),l--,3>l)o.width(148);else{var e=(l/3+(l%3>0?1:0)+"").split(".")[0];e>7&&(e=7),o.width(20+128*e)}a.css({position:"absolute",left:o.width()+1,top:0}),t.noImagesMap[d+l]=!0}).load(function(){var n=$(this),i=n.attr("rel"),s=n.width(),r=n.height();r>s?(n.height(113*r/s),n.width(113)):n.css({width:113*s/r,height:113,marginLeft:-((113*s/r-113)/2)});var d=$('<span class="lodlive-image-controls"><span class="imgControlCenter" title="'+LodLiveUtils.lang("showResource")+'"></span><span class="imgControlZoom" title="'+LodLiveUtils.lang("zoomIn")+'"></span><span class="imgTitle">'+i+"</span></span>");if(u.append(d),u.hover(function(){n.hide()},function(){n.show()}),d.children(".imgControlZoom").hover(function(){u.setBackgroundPosition({x:-1955})},function(){u.setBackgroundPosition({x:-1825})}),d.children(".imgControlCenter").hover(function(){u.setBackgroundPosition({x:-2085})},function(){u.setBackgroundPosition({x:-1825})}),d.children(".imgControlCenter").click(function(){return e.find(".lodlive-close2").click(),t.highlight($("#"+u.attr("data-prop")).children(".box"),8,100,"0 0"),!1}),3>l)o.width(148);else{var c=(l/3+(l%3>0?1:0)+"").split(".")[0];c>7&&(c=7),o.width(20+128*c),a.css({position:"absolute",left:o.width()+1,top:0})}})}l++}}else o.width(148),n.children(".amsg").length||n.append('<span class="amsg">'+LodLiveUtils.lang("imagesNotFound")+"</span>");a.css({position:"absolute",left:o.width()+1,top:0})}else t.highlight(e.children(".images"),2,200,"-610px -450px")}},LodLive.prototype.highlight=function(e,t,n,o){var a=this;if(t>0){t--;var i=e.css("background-position");e.doTimeout(n,function(){e.css({"background-position":o}),e.doTimeout(n,function(){e.css({"background-position":i}),a.highlight(e,t,n,o)})})}},LodLive.prototype.renewDrag=function(e){var t,n=this;n.debugOn&&(start=(new Date).getTime()),e.each(function(){var e=$(this),o=e.attr("id");e.is(".ui-draggable")||e.draggable({stack:".boxWrapper",containment:"parent",start:function(){n.context.find(".lodlive-toolbox").remove(),$("#line-"+o).clearCanvas();var e=n.storeIds["rev"+o];if(e)for(var a=0;a<e.length;a++)t=n.storeIds["gen"+e[a]],$("#line-"+e[a]).clearCanvas()},drag:function(){},stop:function(){n.drawAllLines($(this))}})}),n.debugOn&&console.debug((new Date).getTime()-start+"  renewDrag ")},LodLive.prototype.centerBox=function(e){{var t,n=this,o=n.context.height(),a=n.context.width();e.width()||65,e.height()||65}n.debugOn&&(t=(new Date).getTime());var i=(o-65)/2+(n.context.scrollTop()||0),s=(a-65)/2+(n.context.scrollLeft()||0),r={position:"absolute",left:s,top:i,opacity:0};n.context.parent().scrollTop(o/2-n.context.parent().height()/2+60),n.context.parent().scrollLeft(a/2-n.context.parent().width()/2+60),console.log(n.context.parent().scrollTop()),e.css(r),e.animate({opacity:1},1e3),n.debugOn&&console.debug((new Date).getTime()-t+"  centerBox ")},LodLive.prototype.autoExpand=function(){var e,t=this;t.debugOn&&(e=(new Date).getTime()),$.each(t.innerPageMap,function(e,n){var o=n.children(".relatedBox:not([class*=exploded])");o.length&&(n.parent().length||t.context.append(n),o.each(function(){box=$(moreInfoOnThis);var e=box.attr("relmd5"),n=t.context.children("#"+e);n.length>0&&box.click()}),t.context.children(".innerPage").detach())}),t.context.find(".relatedBox:not([class*=exploded])").each(function(){var e=$(this),t=e.attr("relmd5"),n=context.children("#"+t);n.length>0&&e.click()}),t.debugOn&&console.debug((new Date).getTime()-e+"  autoExpand ")},LodLive.prototype.addNewDoc=function(e,t,n){var o,a=this;a.debugOn&&(o=(new Date).getTime());var i=t.attr("relmd5"),s=a.context.find("#"+i),r=t.is(".inverse"),l=!0;t=$(t),s.length||(s=$(a.boxTemplate),l=!1);var d=t.data("circleid"),c=$("#"+d);if(a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 01 "),!r){a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 02 ");var p=a.storeIds["gen"+d];if(p){if(-1!=$.inArray(i,p))return;p.push(i)}else p=[i];a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 03 "),a.storeIds["gen"+d]=p,p=a.storeIds["rev"+i],p?-1==$.inArray(d,p)&&p.push(d):p=[d],a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 04 "),a.storeIds["rev"+i]=p}var u=t.data("property"),v=t.attr("rel");s.attr("id",i),s.attr("rel",v);var h=r?'div[data-property="'+u+'"][rel="'+v+'"]':null;if(a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 05 "),t.hide(),l)r?a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 11 "):(a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 10 "),a.renewDrag(a.context.children(".boxWrapper")),a.drawaLine(e,s,u));else{a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 06 ");var f=parseInt(t.attr("data-circlePos"),10),g=parseInt(t.attr("data-circleParts"),10),y=a.circleChords(g>10?f%2>0?3*c.width():2*c.width():5*c.width()/2,g,c.position().left+e.width()/2,c.position().top+c.height()/2,null,f);a.context.append(s),s.css({left:y[0][0]-s.height()/2,top:y[0][1]-s.width()/2,opacity:1,zIndex:99}),a.renewDrag(a.context.children(".boxWrapper")),a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 07 "),r?(debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 09 "),a.openDoc(v,s,h)):(a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc 08 "),a.doInverse?a.openDoc(v,s,h):a.openDoc(v,s),a.drawaLine(e,s,u))}return n&&n(),a.debugOn&&console.debug((new Date).getTime()-o+"  addNewDoc "),!1},LodLive.prototype.removeDoc=function(e){var t=this;t.debugOn&&(start=(new Date).getTime()),t.context.find(".lodlive-toolbox").remove();var n=e.attr("id");t.queryConsole("remove",{uriId:e.attr("rel")}),t.context.find("#line-"+n).clearCanvas();var o=t.storeIds["rev"+n];if(o)for(var a=0;a<o.length;a++)t.context.find("#line-"+o[a]).clearCanvas();t.docInfo("","close");var i=t.context.find(".lodLiveControlPanel");if(t.doCollectImages){var s=t.imagesMap;s[n]&&(delete s[n],t.updateImagePanel(i),i.find("a[class*=img-"+n+"]").remove())}if(t.doDrawMap){var r=t.mapsMap;r[n]&&(delete r[n],t.updateMapPanel(i))}e.fadeOut("normal",null,function(){e.remove(),$.each(t.innerPageMap,function(e,o){if(o.children("."+n).length){var a=t.context.find("#"+e);a.append(o);var i=a.find(".lastClick").attr("rel");a.children(".innerPage").children("."+i).length||a.children(".innerPage").detach()}}),t.context.find("."+n).each(function(){var e=$(this);e.show(),e.removeClass("exploded")});var o,a,i,s=t.storeIds["gen"+n],r=t.storeIds["rev"+n];if(r)for(o=0;o<r.length;o++)if(i=t.storeIds["gen"+r[o]])for(a=0;a<i.length;a++)i[a]===n&&i.splice(a,1);if(s)for(o=0;o<s.length;o++)if(i=t.storeIds["rev"+s[o]])for(a=0;a<i.length;a++)i[a]==n&&i.splice(a,1);if(r=t.storeIds["rev"+n])for(o=0;o<r.length;o++)if(s=t.storeIds["gen"+r[o]])for(a=0;a<s.length;a++)t.drawaLine(t.context.find("#"+r[o]),t.context.find("#"+s[a]));delete t.storeIds["rev"+n],delete t.storeIds["gen"+n]}),t.debugOn&&console.debug((new Date).getTime()-start+"  removeDoc ")};var _builtins={expand:{title:"Expand all",icon:"fa fa-arrows-alt",handler:function(e){var t=0,n=e.find(".relatedBox:visible"),o=n.length,a=function(){var e=n.eq(t++);e.length&&e.click(),o>t&&window.setTimeout(a,75)};window.setTimeout(a,75)}},info:{title:"More info",icon:"fa fa-info-circle",handler:function(e,t){t.queryConsole("show",{uriId:e.attr("rel")})}},rootNode:{title:"Make root node",icon:"fa fa-dot-circle-o",handler:function(e,t){t.context.empty(),t.init(e.attr("rel"))}},remove:{title:"Remove this node",icon:"fa fa-trash",hander:function(e,t){t.removeDoc(e)}},openPage:{title:"Open in another page",icon:"fa fa-external-link",handler:function(e){window.open(e.attr("rel"))}}};LodLive.prototype.addClick=function(e,t){var n=this;n.debugOn&&(start=(new Date).getTime()),e.find(".relatedBox").each(function(){var t=$(this);t.attr("relmd5",n.hashFunc(t.attr("rel"))),t.click(function(o){t.addClass("exploded"),n.addNewDoc(e,t),o.stopPropagation()}),t.hover(function(){n.msg(t.data("title"),"show",null,null,t.is(".inverse"))},function(){n.msg(null,"hide")})}),e.find(".groupedRelatedBox").each(function(){var t=$(this);t.click(function(){t.data("show")?(t.data("show",!1),n.docInfo("","close"),t.removeClass("lastClick"),e.find("."+t.attr("rel")).fadeOut("fast"),t.fadeTo("fast",1),e.children(".innerPage").detach()):(t.data("show",!0),e.append(n.innerPageMap[e.attr("id")]),n.docInfo("","close"),e.find(".lastClick").removeClass("lastClick").click(),e.children(".innerPage").length||e.append(n.innerPageMap[e.attr("id")]),t.addClass("lastClick"),e.find("."+t.attr("rel")+":not([class*=exploded])").fadeIn("fast"),t.fadeTo("fast",.3))}),t.hover(function(){n.msg(t.attr("data-title"),"show",null,null,t.is(".inverse"))},function(){n.msg(null,"hide")})}),n.innerPageMap[e.attr("id")]=e.children(".innerPage"),e.children(".innerPage").detach(),e.find(".actionBox[rel=contents]").click(function(){n.docInfo(e,"open")}),e.find(".actionBox[rel=tools]").click(function(){var t=$(this),o=t.find(".lodlive-toolbox");if(o.length)o.fadeToggle("fast");else{o=$('<div class="lodlive-toolbox"></div>'),jQuery.each(n.UI.tools,function(){var t,a=this;a.builtin&&(a=_builtins[a.builtin]),t=jQuery('<div class="innerActionBox" title="'+LodLiveUtils.lang(a.title)+'"><span class="'+a.icon+'"></span></div>'),t.appendTo(o).on("click",function(){a.handler.call(n,e,n)})});var a=$('<div class="lodlive-toolbox-wrapper"></div>').append(o);t.append(a),o.fadeIn("fast")}}),t&&t(),n.debugOn&&console.debug((new Date).getTime()-start+"  addClick ")},LodLive.prototype.parseRawResourceDoc=function(destBox,URI){var inst=this;inst.debugOn&&(start=(new Date).getTime());var uris=[],bnodes=[],values=[],def=inst.options["default"];if(def){var res=LodLiveUtils.getSparqlConf("document",def,inst.options).replace(/\{URI\}/gi,URI),url=def.endpoint+"?uri="+encodeURIComponent(URI)+"&query="+encodeURIComponent(res);inst.showInfoConsole&&inst.queryConsole("log",{title:LodLiveUtils.lang("endpointNotConfiguredSoInternal"),text:res,uriId:URI}),$.ajax({url:url,contentType:"application/json",dataType:"jsonp",beforeSend:function(){inst.context.append(destBox),destBox.html('<img style="margin-left:'+destBox.width()/2+'px;margin-top:147px" src="img/ajax-loader-gray.gif"/>'),destBox.css({position:"fixed",right:20,top:0}),destBox.attr("data-top",destBox.position().top)},success:function(json){json=json.results&&json.results.bindings,$.each(json,function(key,value){eval("uri"===value.object.type?"uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"bnode"==value.object.type?"bnodes.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),destBox.html(""),inst.debugOn&&(console.debug(URI+"   "),console.debug(values)),inst.formatDoc(destBox,values,uris,bnodes,URI)},error:function(){destBox.html(""),values=[{"http://system/msg":"risorsa non trovata: "+destBox.attr("rel")}],inst.formatDoc(destBox,values,uris,bnodes,URI)}})}inst.debugOn&&console.debug((new Date).getTime()-start+"  parseRawResourceDoc ")},LodLive.prototype.docInfo=function(obj,action){var inst=this,docInfo=inst.container.find(".lodlive-docinfo");switch(inst.debugOn&&(start=(new Date).getTime()),action){case"open":docInfo.length||(docInfo=$('<div class="lodlive-docinfo" rel="info-'+URI+'"></div>'),inst.container.append(docInfo));var URI=obj.attr("rel");docInfo.attr("rel",URI);var SPARQLquery=inst.composeQuery(URI,"document"),uris=[],bnodes=[],values=[];0===SPARQLquery.indexOf("http://system/dummy")?inst.parseRawResourceDoc(docInfo,URI):$.ajax({url:SPARQLquery,contentType:"application/json",dataType:"jsonp",success:function(json){json=json.results&&json.results.bindings,$.each(json,function(key,value){eval("uri"==value.object.type?"uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"bnode"==value.object.type?"bnodes.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})":"values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),docInfo.html(""),inst.formatDoc(docInfo,values,uris,bnodes,URI)},error:function(){destBox.html(""),values=[{"http://system/msg":"risorsa non trovata: "+destBox.attr("rel")}],inst.formatDoc(docInfo,values,uris,bnodes,URI)}});break;default:docInfo.fadeOut("fast")}inst.debugOn&&console.debug((new Date).getTime()-start+"  docInfo ")},LodLive.prototype.processDraw=function(e,t,n,o,a,i){var s,r=this,l=r.options;r.debugOn&&(s=(new Date).getTime());var d="",c="standardLine";if(r.context.find("#"+i).length>0){d=a.attr("data-propertyName-"+i);var p=d.split("|");d="\n";for(var u=0;u<p.length;u++){l.arrows[$.trim(p[u])]&&(c=r.options.arrows[$.trim(p[u])]+"Line");{var v=LodLive.shortenKey(p[u]);v.lastIndexOf("#"),v.lastIndexOf("/")}-1==d.indexOf("\n"+v+"\n")&&(d+=v+"\n")}}"isSameAsLine"!==c?r.standardLine(d,e,t,n,o,a,i):LodLiveUtils.customLines(r.context,c,d,e,t,n,o,a,i),r.debugOn&&console.debug((new Date).getTime()-s+"  processDraw ")},LodLive.prototype.drawAllLines=function(e){var t,n=this,o=e.attr("id"),a=n.storeIds["gen"+o],i=n.storeIds["rev"+o];if(n.context.find("#line-"+o).clearCanvas(),a)for(t=0;t<a.length;t++)n.drawaLine(e,n.context.find("#"+a[t]));if(i)for(t=0;t<i.length;t++)if(a=n.storeIds["gen"+i[t]],$("#line-"+i[t]).clearCanvas(),a)for(var s=0;s<a.length;s++)n.drawaLine(n.context.find("#"+i[t]),n.context.find("#"+a[s]))},LodLive.prototype.drawaLine=function(e,t,n){var o,a=this;a.debugOn&&(o=(new Date).getTime());var i=e.position(),s=t.position(),r=$("#line-"+e.attr("id"));1==r.length?(n&&r.attr("data-propertyName-"+t.attr("id"),n),a.processDraw(i.left+e.width()/2,i.top+e.height()/2,s.left+t.width()/2,s.top+t.height()/2,r,t.attr("id"))):(r=$("<canvas data-propertyName-"+t.attr("id")+'="'+n+'" height="'+a.context.height()+'" width="'+a.context.width()+'" id="line-'+e.attr("id")+'"></canvas>'),a.context.append(r),r.css({position:"absolute",zIndex:"0",top:0,left:0}),a.processDraw(i.left+e.width()/2,i.top+e.height()/2,s.left+t.width()/2,s.top+t.height()/2,r,t.attr("id"))),a.debugOn&&console.debug((new Date).getTime()-o+"  drawaLine ")},LodLive.prototype.formatDoc=function(e,t,n,o,a){var i=this;i.debugOn&&(console.debug("formatDoc 0"),start=(new Date).getTime());var s=i.getJsonValue(n,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","default");e.addClass(i.getProperty("document","className",s));var r=i.getProperty("images","properties",s),l=i.getProperty("weblinks","properties",s),d=i.getProperty("document","propertiesMapper",a.replace(/(http:\/\/[^\/]+\/).+/,"$1"));Array.isArray(r)||(r=[r]),Array.isArray(l)||(l=[l]);var c="<div></div>",p=$(c),u=[];$.each(t,function(e,t){for(var n in t){var o={};o[n]=t[n],u.push(o)}}),i.debugOn&&console.debug("formatDoc 1");var v=[],h=[],f=[];$.each(n,function(e,t){for(var n in t){var o={};o[n]=t[n],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!=n?-1!=$.inArray(n,r)?v.push(o):-1!=$.inArray(n,l)&&h.push(o):f.push(unescape(t[n]))}}),i.debugOn&&console.debug("formatDoc 2");var g=null;v.length>0&&(g=$('<div class="section" style="height:80px"></div>'),$.each(v,function(e,t){for(var n in t)g.append('<a class="relatedImage" href="'+unescape(t[n])+'"><img src="'+unescape(t[n])+'"/></a> ')})),i.debugOn&&console.debug("formatDoc 3");var y=null;h.length>0&&(y='<div class="section"><ul style="padding:0;margin:0;display:block;overflow:hidden;tex-overflow:ellipses">',$.each(h,function(e,t){for(var n in t)y+='<li><a class="relatedLink" target="_blank" data-title="'+n+" \n "+unescape(t[n])+'" href="'+unescape(t[n])+'">'+unescape(t[n])+"</a></li>"}),y+="</ul></div>"),i.debugOn&&console.debug("formatDoc 4");var m=$("<div></div>");if(i.debugOn&&console.debug("formatDoc 5"),f.length>0){var x=$('<div class="section"><label data-title="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">type</label><div></div></div>');x.find("label").each(function(){var e=$(this);e.hover(function(){i.msg(e.attr("data-title"),"show")},function(){i.msg(null,"hide")})});for(var b=0;b<f.length;b++){var L=LodLive.shortenKey(f[b]);x.children("div").append('<span title="'+f[b]+'">'+L+" </span>")}m.append(x)}if(i.debugOn&&console.debug("formatDoc 6"),g&&m.append(g),y){var w=$(y);w.find("a").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),m.append(w)}if(i.debugOn&&console.debug("formatDoc 7"),d?$.each(d,function(e,t){$.each(u,function(n,o){for(var a in o)if(e==a){var s=t;try{var r=$('<div class="section"><label data-title="'+a+'">'+s+"</label><div>"+unescape(o[a])+"</div></div>");r.find("label").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),m.append(r)}catch(l){}return!0}})}):$.each(u,function(e,t){for(var n in t){for(var o=n;o.indexOf("/")>-1;)o=o.substring(o.indexOf("/")+1);for(;o.indexOf("#")>-1;)o=o.substring(o.indexOf("#")+1);try{var a=$('<div class="section"><label data-title="'+n+'">'+o+"</label><div>"+unescape(t[n])+"</div></div>");a.find("label").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),m.append(a)}catch(s){}}}),o.length>0&&$.each(o,function(e,t){for(var n in t){var o=LodLive.shortenKey(n),s=$('<div class="section"><label data-title="'+n+'">'+o+'</label><span class="bnode"></span></div><div class="separ sprite"></div>');s.find("label").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),i.resolveBnodes(unescape(t[n]),a,s,m)}}),0==u.length&&0==o.length){var x=$('<div class="section"><label data-title="'+LodLiveUtils.lang("resourceMissingDoc")+'"></label><div>'+LodLiveUtils.lang("resourceMissingDoc")+'</div></div><div class="separ sprite"></div>');x.find("label").each(function(){$(this).hover(function(){i.msg($(this).attr("data-title"),"show")},function(){i.msg(null,"hide")})}),m.append(x)}e.append(p),e.append(m),m.find(".relatedImage").each(function(){$(this).fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:400,type:"image",speedOut:200,hideOnContentClick:!0,showCloseButton:!1,overlayShow:!1}),$(this).find("img").each(function(){$(this).load(function(){$(this).width()>$(this).height()?($(this).height(80*$(this).height()/$(this).width()),$(this).width(80)):($(this).width(80*$(this).width()/$(this).height()),$(this).height(80))}),$(this).error(function(){$(this).attr("title",LodLiveUtils.lang("noImage")+" \n"+$(this).attr("src")),$(this).attr("src","img/immagine-vuota-"+$.jStorage.get("selectedLanguage")+".png")})})}),i.debugOn&&console.debug((new Date).getTime()-start+"  formatDoc ")},LodLive.prototype.resolveBnodes=function(e,t,n,o){var a=this;a.debugOn&&(start=(new Date).getTime());var i=a.composeQuery(e,"bnode",t);return $.ajax({url:i,contentType:"application/json",dataType:"jsonp",beforeSend:function(){n.find("span[class=bnode]").html('<img src="img/ajax-loader-black.gif"/>')},success:function(e){n.find("span[class=bnode]").html(""),e=e.results.bindings,$.each(e,function(e,i){var s=LodLive.shortenKey(i.property.value);if("uri"==i.object.type);else if("bnode"==i.object.type){var r=$('<span><label data-title="'+i.property.value+'"> / '+s+'</label><span class="bnode"></span></span>');
r.find("label").each(function(){$(this).hover(function(){a.msg($(this).attr("data-title"),"show")},function(){a.msg(null,"hide")})}),n.find("span[class=bnode]").attr("class","").append(r),a.resolveBnodes(i.object.value,t,n,o)}else n.find("span[class=bnode]").append('<div><em title="'+i.property.value+'">'+s+"</em>: "+i.object.value+"</div>");o.append(n),o.height()+40>$(window).height()?(o.slimScroll({height:$(window).height()-40,color:"#fff"}),o.parent().find("div.separLast").remove()):o.parent().append('<div class="separLast"></div>')})},error:function(){n.find("span").html("")}}),a.debugOn&&console.debug((new Date).getTime()-start+"  resolveBnodes "),e},LodLive.prototype.circleChords=function(e,t,n,o,a,i){var s=this;s.debugOn&&(start=(new Date).getTime());var r=[],l=0;if(i){l=i;var d=2*Math.PI*(l/t);r.push([n+e*Math.cos(d),o+e*Math.sin(d)])}else for(;t>l;l++){var d=2*Math.PI*(l/t);r.push([n+e*Math.cos(d),o+e*Math.sin(d)])}return s.debugOn&&console.debug((new Date).getTime()-start+"  circleChords "),r},LodLive.prototype.getRelationshipCSS=function(e){return this.UI.relationships&&this.UI.relationships.hasOwnProperty(e)?this.UI.relationships[e]:{}},LodLive.prototype.getJsonValue=function(e,t,n){var o=this;o.debugOn&&(start=(new Date).getTime());var a=[];return $.each(e,function(e,n){for(var o in n)o==t&&a.push(unescape(n[o]))}),a==[]&&(a=[n]),o.debugOn&&console.debug((new Date).getTime()-start+"  getJsonValue"),a},LodLive.prototype.getProperty=function(e,t,n){var o=this,a=o.options;if(o.debugOn&&(start=(new Date).getTime()),Array.isArray(n)){for(var i=0;i<n.length;i++)if(a[n[i]]&&a[n[i]][e])return t?a[n[i]][e][t]?a[n[i]][e][t]:a["default"][e][t]:a[n[i]][e]?a[n[i]][e]:a["default"][e]}else if(n+="",a[n]&&a[n][e])return t?a[n][e][t]?a[n][e][t]:a["default"][e][t]:a[n][e]?a[n][e]:a["default"][e];return o.debugOn&&console.debug((new Date).getTime()-start+"  getProperty"),a["default"][e]?t?a["default"][e][t]:a["default"][e]:""},LodLive.prototype.format=function(destBox,values,uris,inverses){var inst=this,classMap=inst.classMap,lodLiveProfile=inst.options;inst.debugOn&&(start=(new Date).getTime());var containerBox=destBox.parent("div"),thisUri=containerBox.attr("rel")||"",docType=inst.getJsonValue(uris,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","default");-1!=thisUri.indexOf("~~")&&(docType="bnode");var aClass=inst.getProperty("document","className",docType);"bnode"==docType&&(aClass="bnode"),(null==aClass||"standard"==aClass||""==aClass)&&(classMap[docType]?aClass=classMap[docType]:(aClass="box"+classMap.counter,13===classMap.counter?classMap.counter=1:classMap.counter+=1,classMap[docType]=aClass)),containerBox.addClass(aClass);var titles=inst.getProperty("document","titleProperties",docType),images=inst.getProperty("images","properties",docType),weblinks=inst.getProperty("weblinks","properties",docType),lats=inst.getProperty("maps","lats",docType),longs=inst.getProperty("maps","longs",docType),points=inst.getProperty("maps","points",docType);"string"==typeof titles&&(titles=[titles]),"string"==typeof images&&(images=[images]),"string"==typeof weblinks&&(weblinks=[weblinks]),"string"==typeof lats&&(lats=[lats]),"string"==typeof longs&&(longs=[longs]),"string"==typeof points&&(points=[points]),titles.push("http://system/msg");for(var result='<div class="boxTitle"><span class="ellipsis_text">',a=0;a<titles.length;a++){var resultArray=inst.getJsonValue(values,titles[a],0==titles[a].indexOf("http")?"":titles[a]);if(0!=titles[a].indexOf("http"))-1==result.indexOf($.trim(unescape(titles[a]))+" \n")&&(result+=$.trim(unescape(titles[a]))+" \n");else for(var af=0;af<resultArray.length;af++)-1==result.indexOf(unescape(resultArray[af])+" \n")&&(result+=unescape(resultArray[af])+" \n")}var dataEndpoint=containerBox.attr("data-endpoint")||"";(0==values.length&&0==uris.length||0==dataEndpoint.indexOf("http://system/dummy"))&&(-1!=containerBox.attr("data-endpoint").indexOf("http://system/dummy")&&containerBox.attr("data-endpoint",LodLiveUtils.lang("endpointNotConfigured")),0==uris.length&&0==values.length&&(result='<div class="boxTitle" data-tooltip="'+LodLiveUtils.lang("resourceMissing")+'"><a target="_blank" href="'+thisUri+'"><span class="spriteLegenda"></span>'+thisUri+"</a>")),result+="</span></div>";var jResult=$(result);""==jResult.text()&&"bnode"==docType?jResult.text("[blank node]"):""==jResult.text()&&jResult.text(LodLiveUtils.lang("noName")),destBox.append(jResult);var resourceTitle=jResult.text();jResult.data("tooltip",resourceTitle),destBox.hover(function(){var e=jResult.text();console.log("destbox hover title",e),inst.msg(e,"show","fullInfo",containerBox.attr("data-endpoint"))},function(){inst.msg(null,"hide")});var connectedDocs=[],invertedDocs=[],propertyGroup={},propertyGroupInverted={},connectedImages=[],connectedLongs=[],connectedLats=[],sameDocControl=[];if($.each(uris,function(key,value){for(var akey in value)if(lodLiveProfile.uriSubstitutor&&$.each(lodLiveProfile.uriSubstitutor,function(e,t){value[akey]=value[akey].replace(t.findStr,t.replaceStr)}),$.inArray(akey,images)>-1)eval("connectedImages.push({'"+value[akey]+"':'"+escape(resourceTitle)+"'})");else if(-1==$.inArray(akey,weblinks))if($.inArray(value[akey],sameDocControl)>-1){var aCounter=0;$.each(connectedDocs,function(key2,value2){for(var akey2 in value2)value2[akey2]==value[akey]&&eval("connectedDocs["+aCounter+"] = {'"+akey2+" | "+akey+"':'"+value[akey]+"'}");aCounter++})}else eval("connectedDocs.push({'"+akey+"':'"+value[akey]+"'})"),sameDocControl.push(value[akey])}),inverses&&(sameDocControl=[],$.each(inverses,function(key,value){for(var akey in value)if("bnode"!=docType||-1==value[akey].indexOf("~~"))if(lodLiveProfile.uriSubstitutor&&$.each(lodLiveProfile.uriSubstitutor,function(e,t){value[akey]=value[akey].replace(escape(t.findStr),escape(t.replaceStr))}),$.inArray(value[akey],sameDocControl)>-1){var aCounter=0;$.each(invertedDocs,function(key2,value2){for(var akey2 in value2)if(value2[akey2]==value[akey]){var theKey=akey2;return akey2!=akey&&(theKey=akey2+" | "+akey),eval("invertedDocs["+aCounter+"] = {'"+theKey+"':'"+value[akey]+"'}"),!1}aCounter++})}else eval("invertedDocs.push({'"+akey+"':'"+value[akey]+"'})"),sameDocControl.push(value[akey])})),inst.doDrawMap){for(var a=0;a<points.length;a++)for(var resultArray=inst.getJsonValue(values,points[a],points[a]),af=0;af<resultArray.length;af++)-1!=resultArray[af].indexOf(" ")?(eval("connectedLongs.push('"+unescape(resultArray[af].split(" ")[1])+"')"),eval("connectedLats.push('"+unescape(resultArray[af].split(" ")[0])+"')")):-1!=resultArray[af].indexOf("-")&&(eval("connectedLongs.push('"+unescape(resultArray[af].split("-")[1])+"')"),eval("connectedLats.push('"+unescape(resultArray[af].split("-")[0])+"')"));for(var a=0;a<longs.length;a++)for(var resultArray=inst.getJsonValue(values,longs[a],longs[a]),af=0;af<resultArray.length;af++)eval("connectedLongs.push('"+unescape(resultArray[af])+"')");for(var a=0;a<lats.length;a++)for(var resultArray=inst.getJsonValue(values,lats[a],lats[a]),af=0;af<resultArray.length;af++)eval("connectedLats.push('"+unescape(resultArray[af])+"')");if(connectedLongs.length>0&&connectedLats.length>0){var mapsMap=inst.mapsMap;mapsMap[containerBox.attr("id")]={longs:connectedLongs[0],lats:connectedLats[0],title:thisUri+"\n"+escape(resourceTitle)},inst.updateMapPanel(inst.context.find(".lodlive-controlPanel"))}}if(inst.doCollectImages&&connectedImages.length>0){var imagesMap=inst.imagesMap;imagesMap[containerBox.attr("id")]=connectedImages,inst.updateImagePanel(inst.context.find(".lodlive-controlPanel"))}var totRelated=connectedDocs.length+invertedDocs.length;if(totRelated>16){$.each(connectedDocs,function(e,t){for(var n in t)if(propertyGroup[n]){var o=propertyGroup[n];o.push(t[n]),propertyGroup[n]=o}else propertyGroup[n]=[t[n]]}),$.each(invertedDocs,function(e,t){for(var n in t)if(propertyGroupInverted[n]){var o=propertyGroupInverted[n];o.push(t[n]),propertyGroupInverted[n]=o}else propertyGroupInverted[n]=[t[n]]}),totRelated=0;for(var prop in propertyGroup)propertyGroup.hasOwnProperty(prop)&&totRelated++;for(var prop in propertyGroupInverted)propertyGroupInverted.hasOwnProperty(prop)&&totRelated++}var chordsList=inst.circleChords(75,24,destBox.position().left+65,destBox.position().top+65),chordsListGrouped=inst.circleChords(95,36,destBox.position().left+65,destBox.position().top+65),a=1,inserted={},counter=0,innerCounter=1,objectList=[],innerObjectList=[];$.each(connectedDocs,function(e,t){16==counter&&(counter=0),1==a||15==a&&(a=1);for(var n in t){var o=null;if(propertyGroup[n]&&propertyGroup[n].length>1){if(!inserted[n]){innerCounter=1,inserted[n]=!0;var i=$('<div class="groupedRelatedBox" rel="'+MD5(n)+'" data-property="'+n+'"  data-title="'+n+" \n "+propertyGroup[n].length+" "+LodLiveUtils.lang("connectedResources")+'" ></div>');i.css(inst.getRelationshipCSS(n));var s=n.split(" ");if(-1!=unescape(propertyGroup[n][0]).indexOf("~~"))i.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&i.addClass(lodLiveProfile.arrows[s[r]]);i.css({top:chordsList[a][1]-8+"px",left:chordsList[a][0]-8+"px"}),objectList.push(i),a++,counter++}25>innerCounter&&(o=$('<div class="aGrouped relatedBox '+MD5(n)+" "+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"  data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","display:none;position:absolute;top:"+(chordsListGrouped[innerCounter][1]-8)+"px;left:"+(chordsListGrouped[innerCounter][0]-8)+"px"),o.attr("data-circlePos",innerCounter),o.attr("data-circleParts",36),o.attr("data-circleid",containerBox.attr("id"))),innerCounter++}else o=$('<div class="relatedBox '+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"   data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),o.attr("data-circlePos",a),o.attr("data-circleParts",24),a++,counter++;if(o){o.attr("data-circleid",containerBox.attr("id")),o.attr("data-property",n),o.css(inst.getRelationshipCSS(n));var s=n.split(" ");if(-1!=o.attr("rel").indexOf("~~"))o.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&o.addClass(lodLiveProfile.arrows[s[r]]);o.hasClass("aGrouped")?innerObjectList.push(o):objectList.push(o)}}}),inserted={},$.each(invertedDocs,function(e,t){16==counter&&(counter=0),1==a||15==a&&(a=1);for(var n in t){var o=null;if(propertyGroupInverted[n]&&propertyGroupInverted[n].length>1){if(!inserted[n]){innerCounter=1,inserted[n]=!0;var i=$('<div class="groupedRelatedBox inverse" rel="'+MD5(n)+'-i"   data-property="'+n+'" data-title="'+n+" \n "+propertyGroupInverted[n].length+" "+LodLiveUtils.lang("connectedResources")+'" ></div>');i.css(inst.getRelationshipCSS(n));var s=n.split(" ");if(-1!=unescape(propertyGroupInverted[n][0]).indexOf("~~"))i.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&i.addClass(lodLiveProfile.arrows[s[r]]);i.css({top:+(chordsList[a][1]-8)+"px",left:+(chordsList[a][0]-8)+"px"}),objectList.push(i),a++,counter++}if(25>innerCounter){var l=unescape(0==t[n].indexOf("~~")?thisUri+t[n]:t[n]);o=$('<div class="aGrouped relatedBox inverse '+MD5(n)+"-i "+MD5(unescape(t[n]))+' " rel="'+l+'"  data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","display:none;position:absolute;top:"+(chordsListGrouped[innerCounter][1]-8)+"px;left:"+(chordsListGrouped[innerCounter][0]-8)+"px"),o.attr("data-circlePos",innerCounter),o.attr("data-circleParts",36),o.attr("data-circleId",containerBox.attr("id"))}innerCounter++}else o=$('<div class="relatedBox inverse '+MD5(unescape(t[n]))+'" rel="'+unescape(t[n])+'"   data-title="'+n+" \n "+unescape(t[n])+'" ></div>'),o.attr("style","top:"+(chordsList[a][1]-8)+"px;left:"+(chordsList[a][0]-8)+"px"),o.attr("data-circlePos",a),o.attr("data-circleParts",24),a++,counter++;if(o){o.attr("data-circleId",containerBox.attr("id")),o.attr("data-property",n),o.css(inst.getRelationshipCSS(n));var s=n.split(" ");if(-1!=o.attr("rel").indexOf("~~"))o.addClass("isBnode");else for(var r=0;r<s.length;r++)lodLiveProfile.arrows[s[r]]&&o.addClass(lodLiveProfile.arrows[s[r]]);o.hasClass("aGrouped")?innerObjectList.push(o):objectList.push(o)}}});for(var page=0,totPages=objectList.length>14?objectList.length/14+(objectList.length%14>0?1:0):1,i=0;i<objectList.length;i++){if(i%14==0){page++;var aPage=$('<div class="page page'+page+'" style="display:none"></div>');page>1&&totPages>1&&aPage.append('<div class="pager pagePrev sprite" data-page="page'+(page-1)+'" style="top:'+(chordsList[0][1]-8)+"px;left:"+(chordsList[0][0]-8)+'px"></div>'),totPages>1&&totPages-1>page&&aPage.append('<div class="pager pageNext sprite" data-page="page'+(page+1)+'" style="top:'+(chordsList[15][1]-8)+"px;left:"+(chordsList[15][0]-8)+'px"></div>'),containerBox.append(aPage)}containerBox.children(".page"+page).append(objectList[i])}if(page=0,totPages=innerObjectList.length/24+(innerObjectList.length%24>0?1:0),innerObjectList.length>0){containerBox.append('<div class="innerPage"></div>');for(var i=0;i<innerObjectList.length;i++)containerBox.children(".innerPage").append(innerObjectList[i])}containerBox.children(".page1").fadeIn("fast"),containerBox.children(".page").children(".pager").click(function(){var e=$(this);containerBox.find(".lastClick").removeClass("lastClick").click(),e.parent().fadeOut("fast",null,function(){$(this).parent().children("."+e.attr("data-page")).fadeIn("fast")})});var obj=$('<div class="actionBox contents" rel="contents"  ><span class="fa fa-list"></span></div>');containerBox.append(obj),obj.hover(function(){$(this).parent().children(".box").setBackgroundPosition({y:-260})},function(){$(this).parent().children(".box").setBackgroundPosition({y:0})}),obj=$('<div class="actionBox tools" rel="tools" ><span class="fa fa-cog"></span></div>'),containerBox.append(obj),obj.hover(function(){containerBox.children(".box").setBackgroundPosition({y:-130})},function(){containerBox.children(".box").setBackgroundPosition({y:0})}),inst.debugOn&&console.debug((new Date).getTime()-start+"	format ")},LodLive.prototype.openDoc=function(anUri,destBox,fromInverse){var inst=this;anUri||$.error("LodLive: no uri for openDoc"),inst.debugOn&&(start=(new Date).getTime());var uris=[],values=[];inst.showInfoConsole&&(inst.queryConsole("init",{uriId:anUri}),inst.queryConsole("log",{uriId:anUri,resource:anUri})),inst.debugOn&&console.log("composing query with anUri",anUri);var SPARQLquery=inst.composeQuery(anUri,"documentUri");if(inst.doStats&&methods.doStats(anUri),-1!=SPARQLquery.indexOf("endpoint=")){var endpoint=SPARQLquery.substring(SPARQLquery.indexOf("endpoint=")+9);endpoint=endpoint.substring(0,endpoint.indexOf("&")),destBox.attr("data-endpoint",endpoint)}else destBox.attr("data-endpoint",SPARQLquery.substring(0,SPARQLquery.indexOf("?")));0==SPARQLquery.indexOf("http://system/dummy")?inst.guessingEndpoint(anUri,function(){inst.openDoc(anUri,destBox,fromInverse)},function(){inst.parseRawResource(destBox,anUri,fromInverse)}):$.ajax({url:SPARQLquery,contentType:"application/json",dataType:"jsonp",beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-8)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results&&json.results.bindings;var conta=0;if($.each(json,function(e,t){var n={},o={};conta++,"uri"===t.object.type||"bnode"===t.object.type?t.object.value==anUri||"bnode"===t.object.type&&inst.ignoreBnodes||(o[t.property.value]=escape("bnode"===t.object.type?anUri+"~~"+t.object.value:t.object.value),uris.push(o)):(n[t.property.value]=escape(t.object.value),values.push(n))}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc eval uris & values"),destBox.children(".box").html(""),inst.doInverse){SPARQLquery=inst.composeQuery(anUri,"inverse");var inverses=[];$.ajax({url:SPARQLquery,contentType:"application/json",dataType:"jsonp",beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-5)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,eval("inverses.push({'"+value.property.value+"':'"+("bnode"==value.object.type?anUri+"~~":"")+escape(value.object.value)+"'})")}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc inverse eval uris ");var callback=function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)};if(inst.doAutoSameas){var counter=0,tot=Object.keys(lodLiveProfile).length;inst.findInverseSameAs(anUri,counter,inverses,callback,tot)}else callback()},error:function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris),inst.showInfoConsole&&inst.queryConsole("log",{error:"error",id:SPARQLquery,uriId:anUri}),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}})}else inst.format(destBox.children(".box"),values,uris),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)},error:function(){inst.errorBox(destBox)}}),inst.debugOn&&console.debug((new Date).getTime()-start+"	openDoc")},LodLive.prototype.parseRawResource=function(destBox,resource,fromInverse){var inst=this,values=[],uris=[],lodLiveProfile=inst.options;if(lodLiveProfile["default"]){var res=LodLiveUtils.getSparqlConf("documentUri",lodLiveProfile["default"],lodLiveProfile).replace(/\{URI\}/gi,resource),url=lodLiveProfile["default"].endpoint+"?uri="+encodeURIComponent(resource)+"&query="+encodeURIComponent(res);inst.showInfoConsole&&inst.queryConsole("log",{title:LodLiveUtils.lang("endpointNotConfiguredSoInternal"),text:res,uriId:resource}),$.ajax({url:url,contentType:"application/json",dataType:"jsonp",beforeSend:function(){destBox.children(".box").html('<img style="margin-top:'+(destBox.children(".box").height()/2-8)+'px" src="img/ajax-loader.gif"/>')},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,"uri"==value.object.type?value.object.value!=resource&&eval("uris.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})"):eval("values.push({'"+value.property.value+"':'"+escape(value.object.value)+"'})")}),inst.debugOn&&console.debug((new Date).getTime()-start+"  openDoc eval uris & values");var inverses=[],callback=function(){destBox.children(".box").html(""),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)};if(inst.doAutoSameas){var counter=0,tot=Object.keys(lodLiveProfile.connection).length;inst.findInverseSameAs(resource,counter,inverses,callback,tot)}else callback()},error:function(e,j,k){destBox.children(".box").html("");var inverses=[];fromInverse&&eval("uris.push({'"+fromInverse.replace(/div\[data-property="([^"]*)"\].*/,"$1")+"':'"+fromInverse.replace(/.*\[rel="([^"]*)"\].*/,"$1")+"'})"),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}})}else{destBox.children(".box").html("");var inverses=[];fromInverse&&eval("uris.push({'"+fromInverse.replace(/div\[data-property="([^"]*)"\].*/,"$1")+"':'"+fromInverse.replace(/.*\[rel="([^"]*)"\].*/,"$1")+"'})"),inst.format(destBox.children(".box"),values,uris,inverses),inst.addClick(destBox,fromInverse?function(){try{$(fromInverse).click()}catch(e){}}:null),inst.doAutoExpand&&inst.autoExpand(destBox)}},LodLive.prototype.errorBox=function(e){var t=this;e.children(".box").addClass("errorBox"),e.children(".box").html("");var n=$('<div class="boxTitle"><span>'+LodLiveUtils.lang("enpointNotAvailable")+"</span></div>");e.children(".box").append(n);var o=$('<div class="actionBox tools">&#160;</div>');o.click(function(){t.removeDoc(e)}),e.append(o),e.children(".box").hover(function(){t.msg(LodLiveUtils.lang("enpointNotAvailableOrSLow"),"show","fullInfo",e.attr("data-endpoint"))},function(){t.msg(null,"hide")})},LodLive.prototype.allClasses=function(e,t,n,o){var a=this;a.debugOn&&(start=(new Date).getTime()),e=a.composeQuery(e,"allClasses");var i=[];$.ajax({url:e,contentType:"application/json",dataType:"jsonp",beforeSend:function(){t.html('<img src="img/ajax-loader.gif"/>')},success:function(e){t.html(LodLiveUtils.lang("choose")),e=e.results&&e.results.bindings,$.each(e,function(t){var n=e[t].object.value;-1==n.indexOf("http://www.openlinksw.com/")&&(n=n.replace(/http:\/\//,""),i.push(n))});for(var a=0;a<i.length;a++)n.append(o.replace(/\{CONTENT\}/g,i[a]))},error:function(){n.append(o.replace(/\{CONTENT\}/g,"si Ã¨ verificato un errore"))}}),a.debugOn&&console.debug((new Date).getTime()-start+"  allClasses")},LodLive.prototype.findInverseSameAs=function(anUri,counter,inverse,callback,tot){var inst=this,lodLiveProfile=inst.options;inst.debugOn&&(start=(new Date).getTime());var innerCounter=0;$.each(lodLiveProfile.connection,function(key,value){if(innerCounter===counter){var skip=!1,keySplit=key.split(",");if(value.useForInverseSameAs)for(var a=0;a<keySplit.length;a++)-1!=anUri.indexOf(keySplit[a])&&(skip=!0);else skip=!0;if(skip)return counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback(),!1;var SPARQLquery=value.endpoint+"?"+(value.endpointType?lodLiveProfile.endpoints[value.endpointType]:lodLiveProfile.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri));value.proxy&&(SPARQLquery=value.proxy+"?endpoint="+value.endpoint+"&"+(value.endpointType?lodLiveProfile.endpoints[value.endpointType]:lodLiveProfile.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri))),$.ajax({url:SPARQLquery,timeout:3e3,contentType:"application/json",dataType:"jsonp",beforeSend:function(){inst.showInfoConsole&&inst.queryConsole("log",{title:value.endpoint,text:LodLiveUtils.getSparqlConf("inverseSameAs",value,lodLiveProfile).replace(/\{URI\}/g,anUri),id:SPARQLquery,uriId:anUri})},success:function(json){json=json.results.bindings;var conta=0;$.each(json,function(key,value){conta++,eval(value.property&&value.property.value?"inverse.splice(1,0,{'"+value.property.value+"':'"+escape(value.object.value)+"'})":"inverse.splice(1,0,{'http://www.w3.org/2002/07/owl#sameAs':'"+escape(value.object.value)+"'})")}),inst.showInfoConsole&&inst.queryConsole("log",{founded:conta,id:SPARQLquery,uriId:anUri}),counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback()},error:function(){inst.showInfoConsole&&inst.queryConsole("log",{error:"error",id:SPARQLquery,uriId:anUri}),counter++,tot>counter?inst.findInverseSameAs(anUri,counter,inverse,callback,tot):callback()}}),inst.debugOn&&console.debug((new Date).getTime()-start+"  findInverseSameAs "+value.endpoint)}innerCounter++}),inst.debugOn&&console.debug((new Date).getTime()-start+"  findInverseSameAs")},LodLive.prototype.findSubject=function(e,t,n,o,a){var i=this,s=i.options;i.debugOn&&(start=(new Date).getTime()),$.each(s.connection,function(o,a){for(var i=o.split(","),r=0;r<i.length;r++)-1!=e.indexOf(i[r])&&(e=a.endpoint+"?"+(a.endpointType?s.endpoints[a.endpointType]:s.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("findSubject",a,s).replace(/\{CLASS\}/g,t).replace(/\{VALUE\}/g,n)),a.proxy&&(e=a.proxy+"?endpoint="+a.endpoint+"&"+(a.endpointType?s.endpoints[a.endpointType]:s.endpoints.all)+"&query="+escape(LodLiveUtils.getSparqlConf("findSubject",a,s).replace(/\{CLASS\}/g,t).replace(/\{VALUE\}/g,n))))});var r=[];$.ajax({url:e,contentType:"application/json",dataType:"jsonp",beforeSend:function(){o.html('<img src="img/ajax-loader.gif"/>')},success:function(e){o.html(""),e=e.results&&e.results.bindings,$.each(e,function(t){r.push(e[t].subject.value)});for(var t=0;t<r.length;t++)a.val(r[t])},error:function(e){o.html("errore: "+e)}}),i.debugOn&&console.debug((new Date).getTime()-start+"  findSubject")},LodLive.prototype.standardLine=function(e,t,n,o,a,i){var s=180*Math.atan2(a-n,o-t)/Math.PI+180,r=t-Math.sqrt((o-t)*(o-t)+(a-n)*(a-n))+60;i.rotateCanvas({rotate:s,x:t,y:n}).drawLine({strokeStyle:"#fff",strokeWidth:1,strokeCap:"bevel",x1:t-60,y1:n,x2:r,y2:n}),s>90&&270>s&&i.rotateCanvas({rotate:180,x:(r+t)/2,y:(n+n)/2}),e=$.trim(e).replace(/\n/g,", "),i.drawText({fillStyle:"#606060",strokeStyle:"#606060",x:(r+t+(t+60>o?-60:60))/2,y:(n+n-(t+60>o?18:-18))/2,text:e,align:"center",strokeWidth:.01,fontSize:11,fontFamily:"'Open Sans',Verdana"}).restoreCanvas().restoreCanvas(),s=Math.atan2(a-n,o-t);var l=.79,d=Math.abs(8/Math.cos(l)),c=o-60*Math.cos(s),p=a-60*Math.sin(s),u=s+Math.PI+l,v=o+Math.cos(u)*d-60*Math.cos(s),h=a+Math.sin(u)*d-60*Math.sin(s),f=s+Math.PI-l,g=o+Math.cos(f)*d-60*Math.cos(s),y=a+Math.sin(f)*d-60*Math.sin(s);i.drawLine({strokeStyle:"#fff",strokeWidth:1,x1:c,y1:p,x2:g,y2:y}),i.drawLine({strokeStyle:"#fff",strokeWidth:1,x1:c,y1:p,x2:v,y2:h})},window.LodLive||(window.LodLive=LodLive),jQuery.fn.lodlive=function(e){return arguments.length?("string"==typeof e&&(e={method:e}),this.each(function(){var t=$(this),n=t.data("lodlive-instance");e.method&&"init"!==e.method.toLowerCase()?LodLive.prototype.hasOwnProperty(method)&&t.data("lodlive-instance")?n[method].apply(n,method.args||[]):jQuery.error("Method "+method+" does not exist on jQuery.lodlive"):(n=new LodLive(t,e.profile),t.data("lodlive-instance",n),n.init(e.firstUri))})):this.data("lodlive-instance")}}(jQuery),function(){var e={},t={};e.getSparqlConf=function(e,t,n){return t.sparql&&t.sparql[e]?t.sparql[e]:n["default"].sparql[e]},e.registerTranslation=function(e,n){t[e]=n},e.setDefaultTranslation=function(e){t["default"]=t[e]||t["default"]},e.lang=function(e,n){var o=n?t[n]||t["default"]:t["default"];return o&&o[e]||e},e.isSameAsLine=function(e,t,n,o,a,i){var s=180*Math.atan2(a-n,o-t)/Math.PI+180,r=t-Math.sqrt((o-t)*(o-t)+(a-n)*(a-n))+60;i.rotateCanvas({rotate:s,x:t,y:n}).drawLine({strokeStyle:"#000",strokeWidth:1,strokeCap:"bevel",x1:t-60,y1:n,x2:r,y2:n}),s>90&&270>s&&i.rotateCanvas({rotate:180,x:(r+t)/2,y:(n+n)/2}),e=$.trim(e).replace(/\n/g,", "),i.drawText({fillStyle:"#000",strokeStyle:"#000",x:(r+t+(t+60>o?-60:60))/2,y:(n+n-(t+60>o?18:-18))/2,text:(t+60>o?" « ":"")+e+(t+60>o?"":" » "),align:"center",strokeWidth:.01,fontSize:11,fontFamily:"'Open Sans',Verdana"}).restoreCanvas().restoreCanvas(),s=Math.atan2(a-n,o-t);var l=.79,d=Math.abs(8/Math.cos(l)),c=o-60*Math.cos(s),p=a-60*Math.sin(s),u=s+Math.PI+l,v=o+Math.cos(u)*d-60*Math.cos(s),h=a+Math.sin(u)*d-60*Math.sin(s),f=s+Math.PI-l,g=o+Math.cos(f)*d-60*Math.cos(s),y=a+Math.sin(f)*d-60*Math.sin(s);i.drawLine({strokeStyle:"#000",strokeWidth:1,x1:c,y1:p,x2:g,y2:y}),i.drawLine({strokeStyle:"#000",strokeWidth:1,x1:c,y1:p,x2:v,y2:h})},e.customLines=function(t,n){return console.log("customLines",n),e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,2)):void 0},window.LodLiveUtils||(window.LodLiveUtils=e)}(),$.fn.setBackgroundPosition=function(e){var t=$.trim(this.css("background-position")),n=-1==t.indexOf("left")?!1:!0;t=t.replace(/top/gi,"").replace(/left/gi,""),t=$.trim(t.replace(/  /g," "));try{var o=t.split(" ");(e.x||0==e.x)&&(o[0]=e.x+"px"),(e.y||0==e.y)&&(o[1]=e.y+"px"),t=n?"left "+o[0]+" top "+o[1]:o[0]+" "+o[1]}catch(a){alert(a)}return this.css({"background-position":t}),this};var MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,o,a,i,s;return a=2147483648&e,i=2147483648&t,n=1073741824&e,o=1073741824&t,s=(1073741823&e)+(1073741823&t),n&o?2147483648^s^a^i:n|o?1073741824&s?3221225472^s^a^i:1073741824^s^a^i:s^a^i}function o(e,t,n){return e&t|~e&n}function a(e,t,n){return e&n|t&~n}function i(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function r(e,a,i,s,r,l,d){return e=n(e,n(n(o(a,i,s),r),d)),n(t(e,l),a)}function l(e,o,i,s,r,l,d){return e=n(e,n(n(a(o,i,s),r),d)),n(t(e,l),o)}function d(e,o,a,s,r,l,d){return e=n(e,n(n(i(o,a,s),r),d)),n(t(e,l),o)}function c(e,o,a,i,r,l,d){return e=n(e,n(n(s(o,a,i),r),d)),n(t(e,l),o)}function p(e){for(var t,n=e.length,o=n+8,a=(o-o%64)/64,i=16*(a+1),s=Array(i-1),r=0,l=0;n>l;)t=(l-l%4)/4,r=l%4*8,s[t]=s[t]|e.charCodeAt(l)<<r,l++;return t=(l-l%4)/4,r=l%4*8,s[t]=s[t]|128<<r,s[i-2]=n<<3,s[i-1]=n>>>29,s}function u(e){var t,n,o="",a="";for(n=0;3>=n;n++)t=e>>>8*n&255,a="0"+t.toString(16),o+=a.substr(a.length-2,2);return o}function v(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);128>o?t+=String.fromCharCode(o):o>127&&2048>o?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}if(!e)return"";e=e.replace(/http:\/\/.+~~/g,""),e=e.replace(/nodeID:\/\/.+~~/g,""),e=e.replace(/_:\/\/.+~~/g,"");var h,f,g,y,m,x,b,L,w,I=Array(),k=7,C=12,$=17,j=22,P=5,D=9,T=14,O=20,B=4,S=11,U=16,M=23,A=6,R=10,q=15,Q=21;for(e=v(e),I=p(e),x=1732584193,b=4023233417,L=2562383102,w=271733878,h=0;h<I.length;h+=16)f=x,g=b,y=L,m=w,x=r(x,b,L,w,I[h+0],k,3614090360),w=r(w,x,b,L,I[h+1],C,3905402710),L=r(L,w,x,b,I[h+2],$,606105819),b=r(b,L,w,x,I[h+3],j,3250441966),x=r(x,b,L,w,I[h+4],k,4118548399),w=r(w,x,b,L,I[h+5],C,1200080426),L=r(L,w,x,b,I[h+6],$,2821735955),b=r(b,L,w,x,I[h+7],j,4249261313),x=r(x,b,L,w,I[h+8],k,1770035416),w=r(w,x,b,L,I[h+9],C,2336552879),L=r(L,w,x,b,I[h+10],$,4294925233),b=r(b,L,w,x,I[h+11],j,2304563134),x=r(x,b,L,w,I[h+12],k,1804603682),w=r(w,x,b,L,I[h+13],C,4254626195),L=r(L,w,x,b,I[h+14],$,2792965006),b=r(b,L,w,x,I[h+15],j,1236535329),x=l(x,b,L,w,I[h+1],P,4129170786),w=l(w,x,b,L,I[h+6],D,3225465664),L=l(L,w,x,b,I[h+11],T,643717713),b=l(b,L,w,x,I[h+0],O,3921069994),x=l(x,b,L,w,I[h+5],P,3593408605),w=l(w,x,b,L,I[h+10],D,38016083),L=l(L,w,x,b,I[h+15],T,3634488961),b=l(b,L,w,x,I[h+4],O,3889429448),x=l(x,b,L,w,I[h+9],P,568446438),w=l(w,x,b,L,I[h+14],D,3275163606),L=l(L,w,x,b,I[h+3],T,4107603335),b=l(b,L,w,x,I[h+8],O,1163531501),x=l(x,b,L,w,I[h+13],P,2850285829),w=l(w,x,b,L,I[h+2],D,4243563512),L=l(L,w,x,b,I[h+7],T,1735328473),b=l(b,L,w,x,I[h+12],O,2368359562),x=d(x,b,L,w,I[h+5],B,4294588738),w=d(w,x,b,L,I[h+8],S,2272392833),L=d(L,w,x,b,I[h+11],U,1839030562),b=d(b,L,w,x,I[h+14],M,4259657740),x=d(x,b,L,w,I[h+1],B,2763975236),w=d(w,x,b,L,I[h+4],S,1272893353),L=d(L,w,x,b,I[h+7],U,4139469664),b=d(b,L,w,x,I[h+10],M,3200236656),x=d(x,b,L,w,I[h+13],B,681279174),w=d(w,x,b,L,I[h+0],S,3936430074),L=d(L,w,x,b,I[h+3],U,3572445317),b=d(b,L,w,x,I[h+6],M,76029189),x=d(x,b,L,w,I[h+9],B,3654602809),w=d(w,x,b,L,I[h+12],S,3873151461),L=d(L,w,x,b,I[h+15],U,530742520),b=d(b,L,w,x,I[h+2],M,3299628645),x=c(x,b,L,w,I[h+0],A,4096336452),w=c(w,x,b,L,I[h+7],R,1126891415),L=c(L,w,x,b,I[h+14],q,2878612391),b=c(b,L,w,x,I[h+5],Q,4237533241),x=c(x,b,L,w,I[h+12],A,1700485571),w=c(w,x,b,L,I[h+3],R,2399980690),L=c(L,w,x,b,I[h+10],q,4293915773),b=c(b,L,w,x,I[h+1],Q,2240044497),x=c(x,b,L,w,I[h+8],A,1873313359),w=c(w,x,b,L,I[h+15],R,4264355552),L=c(L,w,x,b,I[h+6],q,2734768916),b=c(b,L,w,x,I[h+13],Q,1309151649),x=c(x,b,L,w,I[h+4],A,4149444226),w=c(w,x,b,L,I[h+11],R,3174756917),L=c(L,w,x,b,I[h+2],q,718787259),b=c(b,L,w,x,I[h+9],Q,3951481745),x=n(x,f),b=n(b,g),L=n(L,y),w=n(w,m);var E=u(x)+u(b)+u(L)+u(w);return E.toLowerCase()};